<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Keybase Book: </title>
    <meta name="description" content="" />
    <meta name="robots" content="index,follow" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="/static/css/custom.css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/favicon/site.webmanifest">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#030303">
    <meta name="msapplication-TileColor" content="#f0f0f0">
    <meta name="theme-color" content="#f0f0f0">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@KeybaseIO">
    <meta name="twitter:creator" content="@KeybaseIO">
    <meta name="twitter:title" content="Keybase Book">
    <meta name="twitter:description" content="Use Keybase for end-to-end encrypted chat messaging, file sharing, and team collaboration. Get the free app for iOS, Mac, Android, Windows, and Linux.">
    <meta name="twitter:image" content="/static/img/twitter-card.jpg">

    <script>
    function url_for(filename) {
        const prefix = "";
        const STATIC_ASSET_MAP = {};

        if (STATIC_ASSET_MAP.hasOwnProperty(filename)) {
            return prefix + STATIC_ASSET_MAP[filename] + "/" + filename;
        }

        return prefix + filename;
    }
    </script>
  </head>
  <body>

    <div class="app">
      <nav class="site-nav">
            <a class="site-nav__brand" href="/">Keybase&nbsp;<span>Book</span></a>
            
            <div class="site-nav__actions">
                
                <a class="site-nav__jump site-nav__jump--primary" href="https://book.keybase.io/docs/crypto/kbfs" target="_blank">查看原版</a>
                <a class="site-nav__jump" href="https://keybase.io">前往 keybase.io</a>
            </div>
        </nav>
      <main class="main">
        
    <div class="content">
        
        <div class="side-nav side-nav--extended">
        <nav class="chapter-nav">
            <p class="chapter-nav__label">文档</p>
            <ol class="chapter-nav__list">
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/cli" class="chapter-nav__link">命令行 (Command Line)</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/server" class="chapter-nav__link">服务器 (Server)</a>
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/teams" class="chapter-nav__link">团队</a>
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/chat" class="chapter-nav__link">聊天</a>
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/files" class="chapter-nav__link">Keybase 文件系统介绍</a>
                        
                    </li>
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/wallet" class="chapter-nav__link">Stellar 钱包密钥管理</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/crypto" class="chapter-nav__link chapter-nav__link--active">Keybase 加密文档</a>
                        
                            
                            
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                                    
                                
                            
                                
                                    
                                
                            
                                
                                    
                                
                            
                                
                                    
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                            
                                <ol class="chapter-nav__nested-list">
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/key-exchange" class="chapter-nav__nested-link">Keybase 密钥交换 (KEX) 协议</a>
                                    </li>
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/local-key-security" class="chapter-nav__nested-link">本地密钥安全</a>
                                    </li>
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/kbfs" class="chapter-nav__nested-link">加密规范：Keybase 文件系统 (KBFS)</a>
                                    </li>
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/_account-corner-cases" class="chapter-nav__nested-link">Keybase 账户边缘情况（计划）</a>
                                    </li>
                                    
                                </ol>
                            
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/bots" class="chapter-nav__link">机器人 (Bots)</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/linux" class="chapter-nav__link">Linux 用户指南</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/lockdown" class="chapter-nav__link">锁定模式 (Lockdown Mode)</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/client" class="chapter-nav__link">Keybase 客户端架构</a>
                        
                    </li>
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/sites" class="chapter-nav__link">Keybase.pub</a>
                        
                    </li>
                    
                
                    
                
                    
                
            </ol>
            <a href="/account" class="chapter-nav__back">返回章节列表</a>
        </nav>
    </div>
        
        <div class="content__inner">
            <section id="overview" class="content__section">
                <style>
body .kbfs-crypto-spec {
  counter-reset: h2counter;
}
.kbfs-crypto-spec h1 {
  counter-reset: h2counter;
}
.kbfs-crypto-spec h2:before {
  content: counter(h2counter) ".\0000a0\0000a0";
  counter-increment: h2counter;
}
.kbfs-crypto-spec h2 {
  counter-reset: h3counter;
}
.kbfs-crypto-spec h3:before {
  content: counter(h2counter) "." counter(h3counter) ".\0000a0\0000a0";
  counter-increment: h3counter;
}
.kbfs-crypto-spec h3 {
  counter-reset: h4counter;
}
.kbfs-crypto-spec h4:before {
  content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) ".\0000a0\0000a0";
  counter-increment: h4counter;
}
.kbfs-crypto-spec h4 {
  counter-reset: h5counter;
}
.kbfs-crypto-spec h5:before {
  content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) ".\0000a0\0000a0";
  counter-increment: h5counter;
}
.kbfs-crypto-spec p.note {
  font-size: 0.4em;
}
</style>

<div class="kbfs-crypto-spec">
  <h1>加密规范：Keybase 文件系统 (KBFS)</h1>

  <md>
    另请参阅：[KBFS 文档](/docs/kbfs)
  </md>

  <p>版本 2.0</p>
  <p><strong>更新日志</strong></p>
  <ul>
    <li>版本 2.0
      <ul>
        <li>描述新的块加密/哈希方案，解决了 <a href="https://keybase.io/docs-assets/blog/NCC_Group_Keybase_KB2018_Public_Report_2019-02-27_v1.3.pdf">NCC 审计</a> 中的低风险问题 NCC-KB2018-005。我们最终将停止支持使用旧方案生成新块。</li>
      </ul>
    </li>
    <li>版本 1.10
      <ul>
        <li>指向新的团队文档。</li>
      </ul>
    </li>
    <li>版本 1.9
      <ul>
        <li>在我们重构文档时暂时移除关于组织的讨论。</li>
      </ul>
      </li>
    <li>版本 1.8
      <ul>
        <li>关于 KBFS Merkle 树的更多细节和日期。</li>
      </ul>
      </li>
    <li>版本 1.7
    <ul>
      <li>威胁模型</li>
    </ul>
    </li>
    <li>版本 1.6
    <ul>
      <li>说明哪些已实现，哪些正在进行中。</li>
      <li>最后的写入者未加密。</li>
    </ul>
    </li>
    <li>版本 1.5
      <ul>
        <li>移除成对 HMAC，仅使用签名。</li>
        <li>将文件从 <tt>crypto</tt> 重命名为 <tt>kbfs-crypto</tt>。</li>
        <li>移除浏览器/确定性密钥。</li>
      </ul>
    </li>
    <li>版本 1.4
      <ul>
        <li>恢复基于 PRF 的每块密钥生成</li>
        <li>提出 Jeremy 反对对具有只读成员的 TLF 进行 MAC 处理的意见。</li>
        <li>提供系统概述</li>
        <li>更好的密钥交换细节</li>
      </ul>
    </li>
    <li>版本 1.3
      <ul>
        <li>具有每时期文件夹密钥的基于 PRF 的每块密钥生成系统</li>
        <li>尝试在各处一致地使用 "TLF" 而不是 "folder" 或 "directory"</li>
      </ul>
    </li>
    <li>版本 1.2
    <ul>
      <li>描述目录 ID</li>
      <li>详述 \((M_f, m_f)\) 生成</li>
    </ul>
    </li>
    <li>版本 1.1
    <ul>
      <li>组织</li>
      <li>读者可以推送到读者列表</li>
      <li>用于公共和私有数据的 Merkle 树</li>
    </ul>
    </li>
    <li>版本 1.0: 初始修订</li>
  </ul>

  <h2>威胁模型和安全声明</h2>

  <p>
  <strong>端到端安全性</strong>：Keybase 承诺即使在服务器完全受损的情况下，也能保证文件系统数据和元数据的保密性和完整性。</p>

  <p>我们的关键加密假设是：(1) SHA256 的弱抗碰撞性；(2) <a href="http://nacl.cr.yp.to">NaCl</a> 加密库的
  <a href="https://github.com/golang/crypto/tree/master/nacl">Go</a>
  <a href="https://github.com/agl/ed25519">实现</a> 的安全性。
  </p>

  <p>
  <strong>通过访问控制尽力而为</strong>：如果我们的服务器基础设施未受损，我们仅通过访问控制提供：
  </p>

  <ul>
    <li>丢失或退役设备的前向保密性。</li>
    <li>关于哪些私有文件夹有数据，哪些为空的保密性。</li>
    <li>配额数据的保密性。</li>
  </ul>
  <p>
  换句话说，能够访问 Keybase 服务器数据的对手可以：
  了解谁在通过 KBFS 与谁通信；拥有我们将最终用于计费的相同使用详情；如果他们额外恢复了那些设备，将能够恢复为丢失或退役设备加密的数据。
  </p>

  <p>
  当然，我们也是凡人，不相信我们可以无限期地抵御针对我们基础设施的协同攻击，所以我们鼓励我们的用户仅依赖我们的端到端安全声明。
  </p>

  <p>此外，在服务器受损的情况下，我们不保证数据或元数据的可用性。</p>

  <h2>系统概述</h2>

  <p><strong>兄弟密钥和子密钥</strong>。
    Keybase 中的每个用户每台设备保留两个密钥对；一个密钥对用于签名，一个用于加密。私钥永远不会离开设备。签名密钥被称为"兄弟" (siblings)，因为它们都同样强大。任何活动的兄弟密钥都可以配置或撤销另一个设备。子密钥由活动的兄弟密钥签名，但不能委托给其他密钥。一系列兄弟密钥中的第一个被称为"元老" (eldest) 密钥，可以被撤销而不影响其他活动的兄弟密钥。
  </p>

  <p><strong>私有个人目录</strong>
  每个 keybase 用户都有一个私有个人目录，经过密钥处理，以便她的所有设备都可以读写它。
  </p>

  <p><strong>公共目录</strong>
   一个或多个用户的组可以创建公共目录。公共目录中的项目由目录的一个写入者的设备之一签名；它们未加密。公共目录是发布软件或经过验证的声明的好地方。
  </p>

  <p><strong>私有组目录</strong>
    最有趣的情况是，一群拥有读/写权限的人与一些拥有只读权限的人一起共享一个目录。该目录应使用认证加密来保证只有组内的人可以写入它。它应该进一步使用某种机制（目前是普通签名）来确定哪个写入者对哪个写入负责，以便用户不能把话塞进别人的嘴里。
  </p>

  <p><strong>Merkle 树森林</strong> [未实现]
    Keybase 保留公共 Merkle 树用于管理：(1) 每个用户的密钥对和公共身份集合；以及 (2) 文件系统状态的进展，以便服务器不能恶意回滚到以前的状态。
  </p>

  <h2>密钥</h2>

  <h3>元老密钥 (Eldest Key)</h3>

  <p>
    当用户 Alice (\(A\)) 加入时，她首先生成或导入一个密钥对。对于我们当前的用户，这是一个 PGP 密钥对，表示为 (\(P_A,p_A\))。但 PGP 密钥没有什么特别之处，我们可以自由地在未来更改格式。我们称这个密钥对为 Alice 的 <em>元老</em> 密钥对，因为它是潜在的许多兄弟密钥中的第一个。
  </p>

  <h3>每设备密钥 (Per-Device Keys)</h3>
  <p>
    对于她的每台设备，Alice 生成两个每设备密钥对。
    签名密钥成为兄弟密钥 (sibkey)，加密密钥对只是一个子密钥 (subkey)。
  </p>

  <p>
    对于 Alice 的第 \(i\) 个设备，过程如下：
  </p>

  <ol>

   <li>
    随机生成一个 <a href="http://ed25519.cr.yp.to/">Ed25519</a> <a
    href="https://github.com/agl/ed25519">密钥对</a>，产生对 \((E^i_A, e^i_A)\)。在 Ed25519 中，私钥是一个 64 字节的字符串，公钥是一个 32 字节的（派生）字符串。
   </li>

   <li>
     <a href="https://code.google.com/p/go/source/browse/nacl/box/box.go?repo=crypto&r=8fec09c61d5d66f460d227fd1df3473d7e015bc6#32">生成</a> 一个适合与 NaCL 的 <a href="http://nacl.cr.yp.to/box.html">Box</a> 功能（或 Go Crypto 的 <a href="https://code.google.com/p/go/source/browse/nacl/box/box.go?repo=crypto&r=8fec09c61d5d66f460d227fd1df3473d7e015bc6#60">box.Seal</a> 功能）一起使用的 <a href="http://nacl.cr.yp.to/">Curve25519 密钥对</a>。称之为 \((M^i_A,m^i_A)\)。在 Curve25519（蒙哥马利形式）中，公钥和私钥都是 32 字节的字符串。
   </li>

   <li>
    使用有效的兄弟密钥签署 \(E^i_{A}\)；就像在 PGP 中一样，包含由新密钥签署的委托密钥的"反向"签名。将此 <em>sibkey</em> 签名推送到 Alice 的签名链中。有关更多细节，请参阅 <a href="key-exchange">我们的文档</a> 关于密钥交换。
   </li>

   <li>
     使用 \(e^i_{A}\) 签署 \(M^i_{A}\)。将此 <em>subkey</em> 签名推送到 Alice 的签名链中。
   </li>

   <li>
     将 \(e^i_{A}\) 和 \(m^i_{A}\) 存储在设备 \(i\) 上
   </li>
  </ol>

  <h3>密钥 ID (kids)</h3>
  <p>
    Keybase 有一个 "Key ID" 的概念。在 PGP 密钥的情况下，它是公钥材料的哈希。在 ECC 密钥的情况下，它是公钥本身。我们在这里描述如何在版本 1 中构建它们：
  </p>

  <ul>
    <li>对于 PGP 公钥 \(P\)，计算序列化 \(s(P)\)，就像计算 PGP 指纹一样。设 \(t\) 为相关密钥的一个字节类型。例如，对于 RSA，\(t = 1\)；对于 DSA \(t = 17\)。有关完整列表，请参阅 <a href="http://tools.ietf.org/html/rfc4880#section-9.1">RFC 4880</a> 和 <a href="http://tools.ietf.org/html/rfc6637#section-5">RFC 6637</a>。
    然后：
      <blockquote>
        kid(\(P\)) = <tt>0x01</tt> || \(t\) || SHA-256(\(s(P)\)) || <tt>0x0a</tt>
      </blockquote>
    </li>
    <li>对于 NaCl 加密密钥，\(E\)：
      <blockquote>
        kid(E) = <tt>0x01</tt> || <tt>0x21</tt> || E || <tt>0x0a</tt>
      </blockquote>
    </li>
    <li>对于 NaCl EDDSA 密钥，\(M\)：
      <blockquote>
        kid(M) = <tt>0x01</tt> || <tt>0x20</tt> || M || <tt>0x0a</tt>
      </blockquote>
    </li>
  </ul>

  <h2>KBFS 中的顶层文件夹 (TLFs)</h2>

  <p>
  KBFS 中的顶层文件夹 (TLF) 具有一组固定的读取者和写入者，由文件夹名称指定。TLF 中递归包含的每个文件和文件夹都与其父级具有相同的权限。这种组织方式感觉与正常的 POSIX 语义略有不同，但极大地简化了系统。
  </p>

  <h3>私有 TLFs</h3>
  <p>
    我们首先涵盖具有多个读取者和写入者的私有 TLF 的情况，因为这是最通用的。主目录是通用私有组 TLF 的一个简单子例。
  </p>

  <h4>为私有组 TLF 设置密钥</h4>

  <p>
  假设 Alice (\(A\)) 正在为 Bob (\(B\)) 和 Charlie (\(C\)) 创建一个新的 TLF。Bob 拥有读/写权限，而 Charlie 只有只读权限。Alice 在创建文件夹（称之为 \(f\)）时为所有其他用户设置密钥。过程如下：
  </p>
  <ol>
    <li>生成一个随机的 15 字节目录 ID，后缀为 <tt>0x16</tt></li>
    <li>生成一个每 TLF Curve25519 DH 密钥对，用于在站点的私有数据 Merkle 树中包含此文件夹的元数据；称之为 \((M_f, m_f)\)。
    </li>
    <li>生成一个 32 字节的随机密钥（第一个版本为 0）：\(s^{f,0}\) = rand(32)</li>
    <li>生成一个临时 Curve25519 Diffie-Helman 密钥对。称之为 \((M_e,m_e)\)。</li>
    <li>对于 \(\{A,B,C\}\) 中的每个用户 \(u\)：
     <ol>
      <li>对于 \(u\) 的设备集中的每个设备 \(i\)：
        <ol>
          <li>生成 \(s^{f,0,i}_{u} = \) rand(32)。
           这将是密钥的服务器端部分。</li>
           <li>
             \(t^{f,0,i}_{u} = s^{f,0,i}_u \oplus s^{f,0}\)。即，将全局每 TLF 密钥与每用户每设备密钥进行异或运算，得到掩码密钥。
           </li>
          <li>
            \(S^{f,0,i}_{u} = (M_e, \)Box\((m_e, M^i_u, t^{f,0,i}_u))\)。
            即，运行 <a href="http://nacl.cr.yp.to/box.html">NaCl Box</a> 函数，使用临时私钥、用户的公钥设备密钥，以及消息 \(t^{f,0,i}_u\)。
            这个新密钥 \(S^{f,0,i}_u\) 现在可以公开发布。它只能由 \(u\) 的私有设备密钥解密，并需要一些服务器辅助（通过 \(s^{f,0,i}_u\)）。注意，我们将公钥 \(M_e\) 附加到 Box 的输出之前。最终，我们可能需要添加新密钥或替换现有密钥，我们将使用新的临时密钥对这样做。所以 \(M_e\) 最终可能会被替换。
          </li>
        </ol>
       </li>
     </ol>
    </li>
    <li>以明文形式发布以下元数据 (\(md_c\))：
      <ol>
        <li>读取者密钥块。在这种情况下，只有 Charlie 是只读的：
            <blockquote>
               readers = \([ S^{f,0,1}_{C}, S^{f,0,2}_{C}, S^{f,0,3}_{C} ]\)
            </blockquote>
        </li>
        <li>
          写入者密钥块。在这种情况下是 Alice 和 Bob：
            <blockquote>
               writers = \([ S^{f,0,1}_{A}, S^{f,0,2}_{A}, S^{f,0,1}_{B},S^{f,0,2}_{B} ]\)
            </blockquote>
        </li>
        <li>
          公钥 \(M_f\)
        </li>
      </ol>
    </li>
    <li>一些元数据是加密的。构造明文 \(md_{e}\) 为：
      <ol>
        <li>根 TLF 块（下面详细描述）。</li>
        <li>私钥 \(m_f\)。</li>
      </ol>
      <p>
      然后，加密计算为：SecretBox(\(s^{f,0}, md_{e}\))
      </p>
    </li>

  </ol>

 <p>
    注意，服务器可以看到明文的读取者和写入者块，因此可以对它们的更新进行完整性检查。例如，服务器可以检查读取者和写入者是否对应于 TLF 名称，以及在更新期间读取者和写入者是否没有被恶意删除。
  </p>

  <p>
    同样，服务器知道最后的写入者，因为服务器应该检查传入更新的签名。
  </p>

  <p>
    写入者显然可以更新 TLF 的所有元数据和数据。
    读取者可以更改文件夹元数据中的两个字段：他们可以将新密钥推送到读取者密钥列表的末尾；他们可以将文件夹的 "rekey"（重新密钥）位翻转为 "on"。在这两种情况下，他们使用任何有效的签名兄弟密钥签署这些更改。服务器和客户端可以检查对元数据的所有更新是否都经过授权。服务器拒绝未经授权的更新，客户端忽略它们。
  </p>

  <h4>加密块</h4>

  <p>
    一旦她如上所述建立了密钥，Alice 就可以开始加密块了。
    取 TLF \(f\) 中的任意明文块，如 \(b_j\)。
    假设密钥版本为 0。加密步骤：
    <ol>
      <li> 生成一个随机的 32 字节每块密钥 \(s_{j}\)。</li>
      <li> 计算 \(h_{j} = HMAC512(s^{f,0}, s_{j})\)。
      <li> 让 \(h^{[0,31]}_{j}\) 为 \(h_{j}\) 的前 32 个字节，用作块加密密钥。
      <li> 让 \(n\) 为 \(h_{j}\) 的接下来的 24 个字节，用作 nonce。
      <li> 计算：\(B_j = \) SecretBox\((h^{[0,31]}_{j}, n, b_j)\)</li>
      <li> 对于初始发布，将 \(\{n,s_j\}\) 与 \(B_j\) 一起存储在托管存储提供商处。在未来，我们希望将 \(s_{j}\) 存储在我们托管的机器上，以获得更安全的块删除。</li>
    </ol>
  </p>

  <p>
    某种每块密钥的想法是我们希望在未来保留并扩展的。它允许我们在向 CDN 和本地缓存分发加密块时非常自由，而不用担心它们可能永远不会被丢弃。如果我们对每块密钥 \(s_j\) 应用更严格的访问控制，我们仍然保留了一些丢弃块的能力，即使在客户端密钥受损之后。
  </p>

  <p>
    我们没有使用收敛加密或类似的任何东西，所以被使用两次的块两次加密都会不同。然而，客户端将保留每文件夹缓存，将块明文的哈希映射到加密的块 ID。所以他们不应该重新加密/重新上传他们知道是重复的块。实际上，这种本地查找可能已经足够好了，因为通常数据在被复制之前会被读取，许多块副本会命中这个缓存。出于隐私原因，我们不想允许跨顶层目录的块去重。
  </p>

  <h4>FS 结构</h4>

  <p>
    TLF 中的文件形成一个 Merkle 树，就像在其他安全分布式文件系统中一样（包括 <a href="https://spqr.eecs.umich.edu/papers/sfsro-tocs.pdf">SFSRO</a>，
     <a href ="https://www.usenix.org/legacy/event/osdi04/tech/full_papers/li_j/li_j.pdf">SUNDR</a>
     和 <a href="https://www.tahoe-lafs.org/">Tahoe-LAFS</a>）。
    然而，KBFS 做了与 <a href="http://ori.scs.stanford.edu/">ORI 文件系统</a> 相同的简化，取消了 iNode 风格的间接引用。因此，如果不进行更深层次的架构更改，KBFS 无法实现硬链接。
  </p>

  <p>
    块 ID 计算为加密块及其 nonce 的 SHA-256 哈希。使用 nonce \({n}\)（它源自块的密钥）可以防止服务器与文件夹中的另一个写入者勾结，计算出密钥和明文数据的另一种组合，从而导致相同的块密文，进而允许服务器向部分读取者提供替代块（具有相同的块 ID）。通过从密钥派生 nonce，我们保证即使攻击者找到复制密文的方法，块 ID 也会不同，因此攻击会被客户端检测到。有关更多详细信息，请参阅 <a
    href="https://keybase.io/docs-assets/blog/NCC_Group_Keybase_KB2018_Public_Report_2019-02-27_v1.3.pdf">NCC 审计</a> 中的 NCC-KB2018-005。
  </p>

  <p>
    目录节点反过来是文件名到块 ID 的映射。它们被打包成块，并获得与数据块相同的加密处理。这种结构递归向上直到 TLF 根。
  </p>

  <h4>签署根块</h4>

  <p>
    私有共享 TLF 中的读取者和写入者通过认证加密知道，拥有 \(s^{f,0}\) 访问权限的人写入了 \(f\)，但他们不知道是谁。Alice 可能会试图窃取 Bob 工作的功劳，或者 Bob 可能会陷害 Alice 说了些淘气的话。
  </p>

  <p>
    解决这个问题的一个强硬方法是让 Alice 在每次更新时签署 \(f\) 的根块。但这声明太强了。如果 Eve 后来破坏了 Charlie 的密钥，她可以勒索 Alice，因为 Alice 向 Bob、Charlie 和其他所有人证明了她向 \(f\) 写入了特定内容。
  </p>

  <p>
    我们尝试了各种成对对称 MAC 方案，以实现像 OTR 协议中的可否认性。然而，这种方案对于具有非写入读取者的文件夹不起作用。所以我们做了简单的事情，就是用写入者的每设备 EdDSA 签名密钥签署根块的哈希。在所有三种情况下都使用相同的技术：公共目录、没有非写入读取者的私有目录，以及有非写入读取者的私有目录。
  </p>

  <h3>公共目录</h3>

  <p>
    如果用户 \(u\) 用他的第 \(i\) 个设备更新 KBFS 文件夹，他必须通过签署其根块来签署他对整个文件夹状态的更改。这实际上将签署此文件夹中递归包含的所有数据和元数据。
  </p>

  <p>为了签名，\(u\) 计算完整的元数据 \(md\)，如上所述，只是不加密 \(md_e\)。然后他签署该块：
    <blockquote>
      \(\sigma(md) = \) Sign(\(e^i_{u},md\))
    </blockquote>
  </p>

  <p>
   <em>Sign</em> 函数输出签名以及用于生成它的密钥的 KID。这样，验证者就知道使用哪个密钥。
  </p>

  <h3>主目录 (Home Directories)</h3>

  <p>
    如上所述，主目录是 TLF 组目录的特例。当 Alice 为她的所有设备设置加密密钥时，她使用 4.1.1 中描述的协议，迭代她所有的每设备密钥。Alice 可以跳过 4.1.3 中描述的签名步骤，因为她不担心 "混淆作者身份" 攻击，但她仍然需要像公共目录一样签署 \(md\)，以防止服务器欺骗重新密钥。
  </p>

  <h2>保持服务器诚实</h2>

  <p>
    除非我们小心，否则服务器可以选择性地保留文件系统更新，或者向两个不同的客户端提供两个不同版本的 FS。在本节中，我们描述了我们为防止此类攻击而采取的预防措施。
  </p>

  <p>
    我们的总体方法是，服务器从所有敏感的站点数据中创建一个 Merkle 树，然后签署并公布这棵树供所有人查看。我们邀请第三方监视器检查站点 Merkle 树的进展，并检查它们是否遵守指定的加密一致性约束。客户端将它们的文件系统视图与 Merkle 树中发布的视图进行检查，以确服务器没有回滚状态或尝试分叉。
  </p>

  <p>
    有三个独立的 Merkle 树需要考虑：(1) Keybase 核心 Merkle 树，它公布兄弟密钥、公共身份证明和 "关注者" 声明；
    (2) 一个公共数据 Merkle 树，捕获 KBFS 上的所有公共数据；和
    (3) 一个私有数据 Merkle 树，封装 KBFS 上所有私有数据的状态。
  </p>

  <h3>Keybase 核心 Merkle 树</h3>

  <p>
    如 <a href="../server">我们的服务器安全</a> 文档中所述，用户签署关于他们的密钥、他们的身份和他人的身份的声明。他们将这些签名提交给单调增长的签名链，这些签名链被收集到一个全站范围的 Merkle 树中。正如我们在本文档后面描述的那样，除了单个用户之外，这些签名链最终还将覆盖组织。这些结构都存在于 KBFS 之外，应该可以在没有 KBFS 软件的情况下访问。
  </p>

  <h3>公共数据 Merkle 树</h3>

  <p>
    KBFS 上的所有公共目录都被收集到一个全站范围的 Merkle 树中。这棵树的叶子是键值对字典。键是 TLF 的 ID，值是 TLF <tt>RootMetadata</tt> 块的最新签名。此签名递归地包含：此目录的写入者密钥、此目录的根目录条目以及前一个 <tt>RootMetadata</tt> 块的哈希。
  </p>

  <p>
    Merkle 树的内部节点是向上构建的，覆盖叶子中列出的目录 ID 的较短前缀。最终的根被签名，并定期发布，也许每小时一次。
  </p>

  <h3>私有数据 Merkle 树</h3>

  <p>
    私有数据值得与公共数据同等的待遇，但我们必须稍微小心一点，不要泄露：(1) 私有目录修改的频率；或 (2) 更糟糕的是，谁在与谁合作。简单的解决方案可能会允许对手将公共签名链中的设备添加与私有 TLF 中的更改相关联，从而关联共享成员身份。我们采取了一种相当生硬的方法，应该可以解决从服务器到公众的数据泄露问题。
  </p>

  <p>
    当用户 Alice 创建私有 TLF \(f\) 时，她生成一个 Curve25519 密钥对 \((M_f, m_f)\)。她将 \(M_f\) 存储在文件夹的公共元数据中，将 \(m_f\) 存储在文件夹的私有元数据中。
  </p>

  <p>
    每小时，服务器都会为整个站点的私有数据制作一个新的 Merkle 树。算法是：
    <ol>
      <li>生成一个临时 Curve25519 密钥对 \((M_S, m_s)\)</li>
      <li>对于每个私有文件夹 \(f\)：
      <ol>
         <li>
         执行加密 \(C_f \leftarrow\) Box(\(m_s,M_f,\sigma_f\))，其中 \(\sigma_f\) 是 \(f\) 元数据的最新签名。
         </li>
         <li>
          制作 \(f\) 的 ID 到 \(C_f\) 的映射。
         </li>
      </ol>
      </li>
      <li>
        像在公共数据情况下一样，从这些叶子构建一个 Merkle 树，并将该树与公共临时 Curve25519 密钥 \(M_s\) 一起发布。
      </li>
    </ol>

  </p>

  <p>
    当 Alice 的客户端去获取 TLF \(f\) 时，她从服务器获取最新的根，以及服务器最新发布的 Merkle 树。她沿着从根到 \(f\) 的叶子的路径追踪，然后使用 \(m_f\) 解密 \(\sigma_f\)。最后，她检查当前根是否链接回 Merkle 树中发布的根。当然，如果最后一小时内有很多写入，她可能需要遍历数百或数千个链接，但服务器应该批量处理做出此决定所需的所有数据，只需几次 RPC 调用。未来的实现可能还会实现 "跳表" 风格的快进链接，以加快写入繁重期间的这一过程。
  </p>

  <h3>Merkle 树集成</h3>

  <p>
    两个 KBFS Merkle 树的根将被插入到主 Keybase Merkle 树的根块中。这样做在密钥操作和 KBFS 写入之间建立了顺序关系。反过来，这种知识允许 KBFS 客户端确定对 KBFS 的写入是在密钥被撤销之前还是之后发生的，从而确定腐败的服务器是否利用了暴露的密钥。
  </p>

  <h2>密钥设置、重新密钥和撤销</h2>

  <h3>添加新设备</h3>

  <p>
想象一下 Bob 得到了一台新设备。他现在想为它配置访问所有相关 KBFS 文件夹的权限。以下是他将采取的高级步骤：
  </p>

  <ol>
    <li>密钥生成</li>
    <li>密钥认证：用现有的兄弟密钥签署新密钥</li>
    <li>TLF 密钥设置：将密钥添加到相关的读取者和写入者块中</li>
  </ol>

  <p>
第一步，密钥生成，在上面已经涵盖，这里也是一样的。
密钥认证在我们的 <a href="key-exchange">密钥交换</a> 文档中有涵盖。
  </p>

  <h4>TLF 密钥设置</h4>

  <p>
  现在 Bob 必须检查并为他的设备添加对他可以写入的所有加密 Keybase 目录的写入访问权限。称他的新设备为 \(n\)，他的旧设备为 \(d\)。设备 \(d\) 执行以下操作：
  </p>

  <ol>
    <li>生成一个临时 Curve25519 Diffie-Helman 密钥对。称之为 \((M_e,m_e)\)。</li>
    <li>对于 Bob 可以读取的每个 TLF \(f\)：
     <ol>
      <li>使用 \(m^{d}_{B}\) 解密 \(t^{f,0,d}_B\)</li>
      <li>向服务器查询 \(s^{f,0,d}_{B}\) 并进行异或运算以恢复 \(s^{f,0}\)</li>
      <li>使用发送方密钥 \(m_e\) 和接收方密钥 \(M^{n}_{B}\) 加密 \(s^{f,0}\)，
          后者是在设备 \(n\) 上生成的，并在之前的步骤中安全地传输到 \(d\)。</li>
      <li>
        将 \(S^{f,0,n}_B\) 添加到 \(f\) 的写入者（或读取者）列表中，并用 \(e^{d}_B\) 签名
      </li>
      </ol>
    </li>
  </ol>

  <p>
  Bob 将 \((M_e, S^{f,0,n}_B)\) 推送到 TLF \(f\) 的读取者或写入者列表。如果他是读取者，他被允许推送到元数据中的读取者列表。如果他是写入者，他可以随意编辑 \(f\) 的元数据。
  </p>

  <h3>冻结设备 [未实现]</h3>

  <p>
  如果 Alice 丢失了设备 \(d\)，要做的第一件事是通过服务器 "冻结" 对该设备的访问。任何可以作为用户建立会话的设备都可以这样做。一旦设备被冻结，服务器将拒绝接受形式为 \(s^{f,0,d}_{A}\) 的密钥半部分的请求。除了 \(d\) 之外的任何设备都可以请求解冻。
  </p>

  <p>
  Alice 可以采取额外的（可选）步骤。她可以为丢失设备上的每个签名密钥在其签名链中签署一个 <em>密钥冻结</em>。其他客户端应拒绝在冻结窗口期间接受来自冻结密钥的签名。Alice 稍后可以使用下令冻结的同一密钥取消冻结。服务器在这里无法提供帮助，所以 Alice 只有在拥有另一个已配置设备的情况下才能冻结特定密钥。
  </p>

  <h3>退役设备（并可选地添加新设备）</h3>

  <p>
  要退役设备，Alice 首先应如上所述将其冻结，向她的签名链发布最终撤销声明。然后，她的客户端应遍历她具有读或写访问权限的所有 TLF，从密钥块中删除丢失的密钥，然后重新密钥。当然，她需要一个活动的密钥对才能做到这一点。
  假设 \(r\) 是 Alice 丢失的设备，\(d\) 是她当前活动的设备。此外，作为此过程的结果，Alice 可以选择性地配置新设备 \(n\)：
  </p>

  <ol>
    <li>对于 Alice 可以写入的每个 TLF \(f\)：
    <ol>
      <li>生成一个临时 Curve25519 Diffie-Helman 密钥对。称之为 \((M_e,m_e)\)。 </li>
      <li>删除 \(S^{f,0,r}_{A}\)</li>
      <li>要求服务器删除 \(s^{f,0,r}_A\)。</li>
      <li>生成一个新的 32 字节随机密钥（下一个版本为 1）：\(s^{f,1}\) = rand(32)</li>
      <li>对于可以访问 \(f\) 的每个用户 \(u\)
      <ol>
        <li>对于 \(u\) 拥有的每个设备 \(i\)：
          <ol>
            <li>如前所述，生成 \(s^{f,1,i}_{u} = \) rand(32)，作为密钥的服务器端部分</li>
            <li>如前所述，加密：
              \(S^{f,1,i}_{u} = \)Box\((m_e, M^i_u, s^{f,1,i}_u \oplus s^{f,1})\)
            </li>
          </ol>
        </li>
      </ol>
      </li>
      <li>如果正在配置 \(n\)，生成并加密 \(S^{f,1,n}_{A}\)。</li>
      <li>将重新密钥后的密钥块存储到服务器，用 \(e^d_A\) 签名</li>
      <li>将 \(M_e\) 存储到服务器 </li>
      <li>不要费心重新加密旧块，所以保留旧的解密材料（受损密钥除外）</li>
    </ol>
    </li>
    <li>对于 Alice 可以读取的每个 TLF \(f\)：
      <ol>
        <li>要求服务器删除 \(s^{f,0,r}_A\)。</li>
        <li>将 TLF \(f\) 上的 <strong>rekey</strong> 标志翻转为 "on"。更新目录的下一个写入者将执行 Alice 对其可写目录使用的上述协议。</li>
      </ol>
    </li>
    <li>对 Alice 所属的任何组织重新密钥（见下文）。</li>
  </ol>

  <h3>元老密钥更新（或删除）[未实现]</h3>

  <p>
    如果 Alice 担心她所有的兄弟密钥都已受损，她应该从头开始。协议是：
  </p>

  <ol>
    <li>生成一个新的元老密钥对。</li>
    <li>为当前设备生成新的每设备密钥。</li>
    <li>退役所有旧密钥，同时配置设备密钥。</li>
  </ol>

  <p>
    如果只是删除她的账户，Alice 将如上所述操作，但不会生成新密钥或配置新设备。
  </p>

  <h2>组织</h2>

  <p>
    请参阅我们关于 <a href="/docs/teams">团队</a> 的讨论。
  </p>

  <h2>其他主题</h2>

  <h3>文件擦除 [未实现]</h3>

  <p>
    服务器维护每个文件夹正在使用哪些特定于块的密钥的列表。它不知道哪个密钥对应于哪些文件，因为没有解密密钥无法重新创建 TLF 结构。
  </p>

  <h4>使用已配置设备</h4>

  <p>
    假设用户想要删除文件 \(f\)。
    已配置的设备可以计算一个集合 \(I\)，使得对于任何 \(i \in I\)，\(b_i\) 是或曾经是 \(f\) 的一部分。然后客户端要求服务器删除 \(i \in I\) 的 \(s_i\)。只要用户可以写入父 TLF，服务器就会满足此请求。
  </p>

  <h4>没有已配置设备</h4>

  <p>
    如果用户丢失了所有已配置的设备，他可以要求服务器通过删除该 TLF 中所有块的密钥来擦除 TLF。服务器保留一个列表，因此可以执行该任务。当然，只有当用户可以写入此 TLF 时，服务器才会满足此类请求。
  </p>

</div>
            </section>
        </div>
    </div>
        <footer class="footer" data-footer-label="下一章">
        <a class="footer__link" href="/docs/crypto/_account-corner-cases">
            <div class="footer__inner">
            <p class="footer__title" data-chapter-count="D">Keybase 账户边缘情况（计划）</p>
                
            </div>
            <img alt="" class="footer__image" src="/static/img/illos/docs.jpg" loading="lazy" width="870"/>
        </a>
    </footer>
    
    <script src="/static/js/Nav.js" type="module" async></script>

    
        <script src="/static/js/vendor/gsap.min.js"></script>
        <script src="/static/js/vendor/katex.min.js"></script>
        <script src="/static/js/vendor/auto-render.min.js"></script>
        <script src="/static/js/docs.js" type="module" async></script>
    
      </main>
    </div>
    <footer class="site-footer">
  <div class="site-footer__inner">
    <a class="site-footer__brand" href="/">Keybase&nbsp;<span>Book</span></a>
    <ul class="site-footer__list">
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/">Keybase Home</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://github.com/keybase/book-content/issues">Bug Reporting</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/docs/terms">Terms</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/docs/privacypolicy">Privacy</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/docs/acceptable-use-policy">Acceptable Use</a>
      </li>
    </ul>
    


<template id="link-android">
    <a href="https://keybase.io/_/download/keybase-for-android" class="download__button" aria-label="Download Keybase"><img src="https://keybase.io/images/getting-started/play_store_badge_320x94.png" alt="" style="width: 120px;"></a>
    <a class="download__link" href="https://keybase.io/download">Also available for iOS, Linux, Mac OS, and Windows</a>
</template>

<template id="link-ios">
    <a href="https://keybase.io/_/download/keybase-for-ios" class="download__button" aria-label="Download Keybase">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 119.664 40">
    <path
    d="M110.135 0H9.535c-.367 0-.73 0-1.095.002-.306.002-.61.008-.919.013A13.215 13.215 0 005.517.19a6.665 6.665 0 00-1.9.627 6.438 6.438 0 00-1.62 1.18A6.258 6.258 0 00.82 3.617 6.601 6.601 0 00.195 5.52a12.993 12.993 0 00-.179 2.002c-.01.307-.01.615-.015.921V31.56c.005.31.006.61.015.921a12.992 12.992 0 00.18 2.002 6.588 6.588 0 00.624 1.905A6.208 6.208 0 001.998 38a6.274 6.274 0 001.618 1.179 6.7 6.7 0 001.901.63 13.455 13.455 0 002.004.177c.31.007.613.011.919.011.366.002.728.002 1.095.002h100.6c.36 0 .724 0 1.084-.002.304 0 .617-.004.922-.01a13.279 13.279 0 002-.178 6.804 6.804 0 001.908-.63A6.277 6.277 0 00117.666 38a6.395 6.395 0 001.182-1.614 6.604 6.604 0 00.619-1.905 13.506 13.506 0 00.185-2.002c.004-.31.004-.61.004-.921.008-.364.008-.725.008-1.094V9.536c0-.366 0-.73-.008-1.092 0-.306 0-.614-.004-.92a13.507 13.507 0 00-.185-2.003 6.618 6.618 0 00-.62-1.903 6.466 6.466 0 00-2.798-2.8 6.768 6.768 0 00-1.908-.627 13.044 13.044 0 00-2-.176c-.305-.005-.618-.011-.922-.013-.36-.002-.725-.002-1.084-.002z"
    fill="var(--color--content__text)"
    />
    <path
    d="M8.445 39.125c-.305 0-.602-.004-.904-.01a12.687 12.687 0 01-1.87-.164 5.884 5.884 0 01-1.656-.548 5.406 5.406 0 01-1.397-1.016 5.32 5.32 0 01-1.02-1.397 5.722 5.722 0 01-.544-1.657 12.414 12.414 0 01-.166-1.875c-.007-.21-.015-.913-.015-.913v-23.1s.009-.692.015-.895a12.37 12.37 0 01.165-1.872 5.755 5.755 0 01.544-1.662 5.373 5.373 0 011.015-1.398 5.565 5.565 0 011.402-1.023 5.823 5.823 0 011.653-.544A12.586 12.586 0 017.543.887l.902-.012h102.769l.913.013a12.385 12.385 0 011.858.162 5.938 5.938 0 011.671.548 5.594 5.594 0 012.415 2.42 5.763 5.763 0 01.535 1.649 12.995 12.995 0 01.174 1.887c.003.283.003.588.003.89.008.375.008.732.008 1.092v20.929c0 .363 0 .718-.008 1.075 0 .325 0 .623-.004.93a12.731 12.731 0 01-.17 1.853 5.739 5.739 0 01-.54 1.67 5.48 5.48 0 01-1.016 1.386 5.413 5.413 0 01-1.4 1.022 5.862 5.862 0 01-1.668.55 12.542 12.542 0 01-1.869.163c-.293.007-.6.011-.897.011l-1.084.002z"
    fill="var(--color--content__background)"
    />
    <path
    d="M24.997 19.89a5.146 5.146 0 012.45-4.318 5.268 5.268 0 00-4.15-2.244c-1.746-.183-3.44 1.045-4.33 1.045-.906 0-2.276-1.027-3.752-.997a5.527 5.527 0 00-4.65 2.837c-2.012 3.482-.512 8.6 1.415 11.414.963 1.378 2.09 2.918 3.564 2.863 1.442-.06 1.981-.92 3.722-.92 1.725 0 2.23.92 3.734.886 1.548-.026 2.523-1.385 3.453-2.776a11.4 11.4 0 001.58-3.216 4.973 4.973 0 01-3.036-4.575zm-2.841-8.413a5.067 5.067 0 001.16-3.63 5.155 5.155 0 00-3.336 1.726 4.821 4.821 0 00-1.19 3.495 4.263 4.263 0 003.366-1.591zM42.302 27.14h-4.734l-1.136 3.356h-2.005l4.483-12.418h2.083l4.484 12.418h-2.04zm-4.243-1.55h3.752l-1.85-5.446h-.052zm17.101.38c0 2.813-1.507 4.62-3.78 4.62a3.07 3.07 0 01-2.848-1.583h-.043v4.484h-1.858V21.442h1.799v1.506h.034a3.212 3.212 0 012.883-1.6c2.298 0 3.812 1.816 3.812 4.622zm-1.911 0c0-1.833-.947-3.038-2.393-3.038-1.42 0-2.375 1.23-2.375 3.038 0 1.824.956 3.046 2.375 3.046 1.446 0 2.393-1.197 2.393-3.046zm11.876 0c0 2.813-1.507 4.62-3.78 4.62a3.07 3.07 0 01-2.848-1.583h-.043v4.484h-1.858V21.442h1.799v1.506h.034a3.212 3.212 0 012.883-1.6c2.297 0 3.813 1.816 3.813 4.622zm-1.911 0c0-1.833-.947-3.038-2.393-3.038-1.42 0-2.375 1.23-2.375 3.038 0 1.824.955 3.046 2.375 3.046 1.446 0 2.393-1.197 2.393-3.046zm8.496 1.066c.137 1.232 1.333 2.04 2.968 2.04 1.567 0 2.694-.808 2.694-1.919 0-.964-.68-1.54-2.29-1.936l-1.609-.388c-2.28-.55-3.339-1.617-3.339-3.348 0-2.142 1.867-3.614 4.518-3.614 2.625 0 4.424 1.472 4.484 3.614H77.26c-.112-1.239-1.136-1.987-2.634-1.987s-2.521.757-2.521 1.858c0 .878.654 1.395 2.255 1.79l1.368.336c2.548.603 3.605 1.626 3.605 3.443 0 2.323-1.85 3.778-4.793 3.778-2.753 0-4.613-1.42-4.733-3.667zM83.346 19.3v2.142h1.722v1.472h-1.722v4.991c0 .776.345 1.137 1.102 1.137a5.808 5.808 0 00.611-.043v1.463a5.104 5.104 0 01-1.032.086c-1.833 0-2.548-.689-2.548-2.445v-5.189h-1.316v-1.472h1.316V19.3zm2.718 6.67c0-2.849 1.678-4.639 4.294-4.639 2.625 0 4.295 1.79 4.295 4.639 0 2.856-1.661 4.638-4.295 4.638-2.633 0-4.294-1.782-4.294-4.638zm6.695 0c0-1.954-.895-3.108-2.401-3.108s-2.401 1.162-2.401 3.108c0 1.962.895 3.106 2.4 3.106s2.402-1.144 2.402-3.106zm3.426-4.528h1.773v1.541H98a2.16 2.16 0 012.177-1.635 2.866 2.866 0 01.637.069v1.738a2.598 2.598 0 00-.835-.112 1.873 1.873 0 00-1.937 2.083v5.37h-1.858zm13.198 6.395c-.25 1.643-1.85 2.771-3.898 2.771-2.634 0-4.269-1.764-4.269-4.595 0-2.84 1.644-4.682 4.19-4.682 2.506 0 4.08 1.72 4.08 4.466v.637h-6.394v.112a2.358 2.358 0 002.436 2.564 2.048 2.048 0 002.09-1.273zm-6.282-2.702h4.526a2.177 2.177 0 00-2.22-2.298 2.292 2.292 0 00-2.306 2.298zM37.826 8.731a2.64 2.64 0 012.808 2.965c0 1.906-1.03 3.002-2.808 3.002h-2.155V8.73zm-1.228 5.123h1.125a1.876 1.876 0 001.967-2.146 1.881 1.881 0 00-1.967-2.134h-1.125zm5.082-1.41a2.133 2.133 0 114.248 0 2.134 2.134 0 11-4.247 0zm3.334 0c0-.976-.439-1.547-1.208-1.547-.773 0-1.207.571-1.207 1.547 0 .984.434 1.55 1.207 1.55.77 0 1.208-.57 1.208-1.55zm6.559 2.254h-.922l-.93-3.317h-.07l-.927 3.317h-.913l-1.242-4.503h.902l.806 3.436h.067l.926-3.436h.852l.926 3.436h.07l.803-3.436h.889zm2.281-4.503h.855v.715h.066a1.348 1.348 0 011.344-.802 1.465 1.465 0 011.559 1.675v2.915h-.889v-2.692c0-.724-.314-1.084-.972-1.084a1.033 1.033 0 00-1.075 1.141v2.635h-.888zm5.24-1.758h.888v6.26h-.888zm2.124 4.007a2.133 2.133 0 114.247 0 2.134 2.134 0 11-4.247 0zm3.333 0c0-.976-.439-1.547-1.208-1.547-.773 0-1.207.571-1.207 1.547 0 .984.434 1.55 1.207 1.55.77 0 1.208-.57 1.208-1.55zm1.849.98c0-.81.604-1.278 1.676-1.344l1.22-.07v-.389c0-.475-.315-.744-.922-.744-.497 0-.84.182-.939.5h-.86c.09-.773.818-1.27 1.84-1.27 1.128 0 1.765.563 1.765 1.514v3.077h-.855v-.633h-.07a1.515 1.515 0 01-1.353.707 1.36 1.36 0 01-1.501-1.348zm2.895-.384v-.377l-1.1.07c-.62.042-.9.253-.9.65 0 .405.351.64.834.64a1.062 1.062 0 001.166-.983zm2.053-.596c0-1.423.732-2.324 1.87-2.324a1.484 1.484 0 011.38.79h.067V8.437h.888v6.26h-.851v-.71h-.07a1.563 1.563 0 01-1.415.785c-1.145 0-1.869-.901-1.869-2.328zm.918 0c0 .955.45 1.53 1.203 1.53.75 0 1.212-.583 1.212-1.526 0-.938-.468-1.53-1.212-1.53-.748 0-1.203.58-1.203 1.526zm6.964 0a2.133 2.133 0 114.247 0 2.134 2.134 0 11-4.247 0zm3.333 0c0-.976-.438-1.547-1.208-1.547-.772 0-1.207.571-1.207 1.547 0 .984.435 1.55 1.207 1.55.77 0 1.208-.57 1.208-1.55zm2.107-2.249h.855v.715h.066a1.348 1.348 0 011.344-.802 1.465 1.465 0 011.559 1.675v2.915h-.889v-2.692c0-.724-.314-1.084-.972-1.084a1.033 1.033 0 00-1.075 1.141v2.635h-.889zm8.845-1.121v1.141h.976v.749h-.976v2.315c0 .472.194.679.637.679a2.967 2.967 0 00.339-.021v.74a2.916 2.916 0 01-.484.046c-.988 0-1.381-.348-1.381-1.216v-2.543h-.715v-.749h.715V9.074zm2.19-.637h.88v2.481h.07a1.386 1.386 0 011.374-.806 1.483 1.483 0 011.55 1.679v2.907h-.889V12.01c0-.72-.335-1.084-.963-1.084a1.052 1.052 0 00-1.134 1.142v2.63h-.888zm9.056 5.045a1.828 1.828 0 01-1.95 1.303 2.045 2.045 0 01-2.081-2.325 2.077 2.077 0 012.076-2.352c1.253 0 2.009.856 2.009 2.27v.31h-3.18v.05a1.19 1.19 0 001.2 1.29 1.08 1.08 0 001.07-.546zm-3.126-1.451h2.275a1.086 1.086 0 00-1.109-1.167 1.152 1.152 0 00-1.166 1.167z"
    fill="var(--color--content__text)"
    />
</svg>
    </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, Linux, Mac OS, and Windows</a>
</template>

<template id="link-linux">
    <a href="https://keybase.io/docs/the_app/install_linux" class="download__button" aria-label="Download Keybase">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 40">
    <path fill="var(--color--content__text)" d="M0 0h120v40H0z"/>
    <path fill="var(--color--content__background)" d="M1 1h118v38H1z"/>
    <path fill="var(--color--content__text)" d="M100.4 8a6 6 0 00-.5 0c-4.2.4-3.1 4.8-3.2 6.3 0 1.1-.3 2-1 3-.9 1-2.1 2.8-2.7 4.6-.3.8-.4 1.6-.3 2.5h-.1l-.7 1-.8.3c-.3.2-.6.3-.8.7l-.2.6v.5c.1.4.2.8.1 1-.2.7-.3 1.2 0 1.5 0 .3.4.5.8.6.9.2 2 .1 2.8.6 1 .5 1.9.7 2.6.5.6-.1 1-.5 1.2-1l2.3-.3c.7 0 1.6.3 2.6.2l.1.3c.4.8 1.1 1.2 1.9 1.1.8 0 1.6-.5 2.2-1.3.7-.8 1.7-1 2.4-1.5.4-.2.7-.5.7-.9s-.2-.8-.7-1.3v-.1c-.2-.2-.3-.6-.4-1 0-.4-.2-.8-.5-1l-.2-.2h-.2c.5-1.3.3-2.6-.1-3.7-.6-1.4-1.5-2.6-2.2-3.5-.8-1-1.6-2-1.6-3.4 0-2.1.3-6-3.5-6.1zm.5 3.4c.2 0 .4 0 .6.2l.5.5.1.8v-.1.1l-.1.7-.2.3h-.1l-.3-.2h-.2l.1-.2.1-.4v-.5l-.2-.3-.3-.1-.3.1-.2.3v.7l-.6-.2V13v-.8l.5-.5.6-.2zm-3 0l.5.2c.1.1.3.3.3.5l.2.6v.3l-.1.1-.4.2V13v-.3l-.2-.3h-.4l-.1.4v.6c0 .2.1.2.2.3l-.2.2c-.2 0-.3-.2-.4-.4l-.1-.6a1.8 1.8 0 01.3-1.2c.2-.2.3-.2.5-.2zm1.4 1.8c.4 0 .8 0 1.2.4l1.1.4.5.4v-.1.5c-.1.3-.5.6-1 .8l-.8.5c-.3.1-.6.3-1 .3l-.5-.1-.3-.2-.6-.5c-.4-.2-.7-.5-.7-.7-.1-.3 0-.5.2-.6l.4-.3.2-.2.9-.6h.4zm2.8 2.1a24 24 0 001.8 4.5c.2.5.8 1.6 1 3h.6c.6-1.6-.6-3.4-1.1-3.9-.2-.2-.2-.3-.1-.3.6.5 1.3 1.5 1.6 2.7.1.6.2 1.1 0 1.7h.2c1 .6 1.5 1 1.3 1.6h-.2c.1-.5-.2-.9-1-1.3-1-.4-1.7-.3-1.9.5v.1l-.2.1c-.4.3-.7.7-.8 1.2l-.2 1.9-.3 1.3c-1.5 1-3.6 1.5-5.4.3l-.4-.5-.2-.3h.4l.3-.4c.2-.3 0-.7-.3-1.2s-1-1-1.8-1.5c-.6-.4-1-.9-1.1-1.4-.2-.5-.2-1 0-1.6.2-1.1.8-2.2 1.2-2.8l-.4 1c-.4.7-1.1 2.5-.1 3.8 0-1 .2-2 .6-2.9.6-1.2 1.8-3.5 1.9-5.2l.3.2.6.4c.2.2.4.4.8.4h.1c.5 0 .8-.2 1-.3l.8-.4a2 2 0 001-.7zm2.2 9c0 .6.4 1.2.9 1.3.6.2 1.4-.3 1.8-.7h.2c.3 0 .6 0 .8.2.3.2.4.6.4 1l.4 1c.5.5.7.9.7 1.1 0 .3-.2.4-.5.6-.6.4-1.8.7-2.5 1.6-.6.7-1.3 1.1-2 1.2-.7 0-1.2-.2-1.6-1-.2-.3-.1-1 0-1.6.2-.7.5-1.4.5-2l.2-1.7c.1-.5.3-.8.7-1zm-10.8 0h.2c.3 0 .7.4 1 .8l.9 1.6c.2.6.8 1.1 1.2 1.7.4.6.8 1.1.7 1.6 0 .7-.5 1.1-1.1 1.3-.7.1-1.5 0-2.4-.5-1-.5-2.1-.5-2.9-.6-.3 0-.6-.2-.7-.4l.1-1.2c.2-.4 0-.8 0-1.2v-.9c.2-.3.5-.4.7-.5.3-.2.7-.2 1-.5l.6-.8c.2-.2.4-.4.7-.4zm7.2-9c-.5.1-1 .5-1.5.5-.6 0-1-.3-1.3-.5l-.4-.3c-.1-.2-.1-.4 0-.4l.1.2.4.4c.3.2.7.4 1.2.4s1-.2 1.4-.4l.6-.5.3-.3-.2.4-.6.4zm-1.1-1.6v-.1h.3l.1.1-.1.1h-.2l-.1-.1zm-.6 0H99l-.2.1h-.1l.1-.2h.3zM18.1 14v-.9h-3.6v1.3h1.9v.1c0 1-.9 1.8-2 1.8-1.4 0-2.3-1.1-2.3-3 0-1.8.8-2.8 2.2-2.8 1 0 1.7.5 2 1.4H18c-.2-1.7-1.7-2.9-3.7-2.9-2.5 0-4 1.6-4 4.3 0 2.8 1.5 4.4 4 4.4 2.4 0 3.8-1.3 3.8-3.6zM22 12.5c.7 0 1.2.5 1.3 1.3h-2.7c0-.8.6-1.3 1.3-1.3zm1.3 3.2c-.2.5-.6.8-1.3.8-.8 0-1.4-.6-1.4-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3 3.2 1.6 0 2.8-.8 3-2h-1.6zM26.3 9.9v1.4h-1v1.3h1V16c0 1.2.5 1.7 2 1.7h.8v-1.3h-.4c-.5 0-.7-.2-.7-.7v-3H29v-1.3H28V10h-1.7zM34.4 17.6V15l.7-1 2.6 3.6h2l-3.3-4.7 3.2-3.8h-2L34.4 13V9.1h-1.8v8.5h1.8zM42.8 12.5c.7 0 1.3.5 1.3 1.3h-2.7c0-.8.6-1.3 1.4-1.3zm1.3 3.2c-.1.5-.6.8-1.2.8-1 0-1.5-.6-1.5-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3.1 3.2 1.6 0 2.7-.8 2.9-2h-1.6zM47.3 20c1.6 0 2.4-.6 3-2.3l2.1-6.4h-1.8l-1.3 5-1.4-5h-1.8l2.1 6.3v.3c-.1.5-.4.7-1 .7h-.5v1.3h.6zM56.8 17.7c1.6 0 2.5-1.2 2.5-3.2s-1-3.3-2.5-3.3a2 2 0 00-2 1.2V9.1h-1.7v8.5h1.7v-1a2 2 0 002 1.1zm-.6-5.1c.9 0 1.4.7 1.4 1.9 0 1.1-.5 1.8-1.4 1.8-.8 0-1.4-.7-1.4-1.8 0-1.2.6-2 1.4-2zM62.7 16.5c-.6 0-1-.3-1-.8 0-.4.4-.7 1-.8H64v.4c0 .7-.6 1.2-1.3 1.2zm-.6 1.2c.8 0 1.6-.4 2-1v.9h1.6v-4.3c0-1.3-1-2.1-2.7-2.1-1.6 0-2.7.8-2.7 2h1.5c.1-.4.5-.7 1.2-.7.6 0 1 .3 1 .9v.4l-1.6.1c-1.5 0-2.4.8-2.4 1.9 0 1.1 1 1.9 2.1 1.9zM66.7 13.2c0 1 .6 1.5 1.8 1.8l1.1.2c.6.1.8.3.8.7 0 .4-.4.6-1 .6-.7 0-1-.3-1.2-.8h-1.7c.2 1.2 1.2 2 2.9 2 1.6 0 2.7-.8 2.7-2 0-1-.5-1.4-1.8-1.7l-1-.3c-.7 0-1-.3-1-.6 0-.4.4-.7 1-.7.7 0 1 .3 1.1.8H72c0-1.2-1-2-2.7-2-1.6 0-2.6.8-2.6 2zM75.8 12.5c.8 0 1.3.5 1.3 1.3h-2.6c0-.8.6-1.3 1.3-1.3zm1.3 3.2c-.1.5-.6.8-1.2.8-.9 0-1.5-.6-1.5-1.5v-.1h4.4v-.6c0-1.9-1.2-3.1-3-3.1-1.9 0-3 1.3-3 3.3 0 2 1.1 3.2 3 3.2 1.6 0 2.7-.8 3-2H77zM10.9 31.6h1.7v-5h1.2v-1.3h-1.3V25c0-.4.3-.7.8-.7h.5v-1a5 5 0 00-.9-.1c-1.5 0-2 .5-2 1.8v.4H10v1.3h.9v5zM17.4 31.7c1.9 0 3-1.2 3-3.2s-1.1-3.3-3-3.3-3.1 1.2-3.1 3.3c0 2 1.2 3.2 3 3.2zm0-1.3c-.9 0-1.4-.7-1.4-2 0-1.2.6-2 1.4-2 .8 0 1.4.8 1.4 2 0 1.3-.6 2-1.4 2zM21.4 31.6H23v-3.5c0-.9.5-1.4 1.3-1.4h.6v-1.4h-.4c-.8 0-1.3.4-1.5 1.2v-1.2h-1.7v6.3zM33.7 30.1H30v-7h-1.7v8.5h5.4v-1.5zM34.7 31.6h1.7v-6.3h-1.7v6.3zm.8-7.1c.5 0 1-.4 1-1 0-.4-.5-.8-1-.8a.9.9 0 100 1.8zM37.5 31.6h1.7V28c0-.8.5-1.4 1.3-1.4s1.1.5 1.1 1.3v3.7h1.8v-4c0-1.5-.8-2.4-2.2-2.4-1 0-1.7.5-2 1.2v-1h-1.7v6.2zM50.2 25.3h-1.7V29c0 .9-.4 1.4-1.2 1.4-.8 0-1.2-.5-1.2-1.3v-3.7h-1.7v4c0 1.5 1 2.4 2.3 2.4 1 0 1.5-.4 1.9-1.2v1.1h1.6v-6.3zM54 29.4l1.1 2.2H57l-2-3.2 2-3h-1.9l-1 2H54l-1.1-2h-2l2 3-2 3.2h1.8l1.2-2.2z"/>
</svg>
        </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, iOS, Mac OS, and Windows</a>
</template>

<template id="link-mac">
    <a href="https://keybase.io/docs/the_app/install_macos" class="download__button" aria-label="Download Keybase">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 120 40">
  <path fill="var(--color--content__text)" d="M0 0h120v40H0z"/>
  <path fill="var(--color--content__background)" d="M1 1h118v38H1z"/>
  <path fill="var(--color--content__text)" d="M15.2617 13.4492v-.9551h-3.5625v1.2891h1.8399l-.0059.1348c-.0352 1.0488-.8379 1.7578-1.9922 1.7578-1.4062 0-2.29686-1.1192-2.29686-2.9531 0-1.7989.83786-2.85942 2.23246-2.85942.955 0 1.6757.52732 1.9336 1.41212h1.7753c-.2519-1.71095-1.7402-2.87696-3.7148-2.87696-2.48437 0-4.03125 1.64066-4.03125 4.34766 0 2.748 1.54688 4.4004 4.07225 4.4004 2.3555 0 3.75-1.3945 3.75-3.6973zM19.1055 11.8496c.7617 0 1.2832.5508 1.3183 1.3535h-2.666c.0586-.7851.5977-1.3535 1.3477-1.3535zm1.3418 3.2285c-.1582.4805-.6387.791-1.2657.791-.873 0-1.4414-.6152-1.4414-1.5117v-.1054h4.3301v-.5215c0-1.9102-1.1543-3.1465-2.9824-3.1465-1.8574 0-3.0293 1.3008-3.0293 3.3047 0 2.0097 1.1602 3.2461 3.0937 3.2461 1.5528 0 2.6778-.8262 2.8653-2.0567h-1.5703zM23.4121 9.27148v1.44732h-.8848v1.289h.8848v3.2988c0 1.2246.5742 1.7168 2.0508 1.7168.3457 0 .6387-.0293.8144-.0703v-1.2597c-.1054.0175-.2636.0293-.416.0293-.5039 0-.7383-.2286-.7383-.709v-3.0059h1.1602v-1.289H25.123V9.27148h-1.7109zM31.5156 17v-2.584l.791-.9492L34.8145 17h2.1152l-3.3457-4.7051 3.1289-3.74998h-1.9688l-3.1757 3.85548h-.0528V8.54492h-1.7695V17h1.7695zM39.9414 11.8496c.7617 0 1.2832.5508 1.3184 1.3535h-2.666c.0585-.7851.5976-1.3535 1.3476-1.3535zm1.3418 3.2285c-.1582.4805-.6387.791-1.2656.791-.8731 0-1.4414-.6152-1.4414-1.5117v-.1054h4.33v-.5215c0-1.9102-1.1542-3.1465-2.9824-3.1465-1.8574 0-3.0293 1.3008-3.0293 3.3047 0 2.0097 1.1602 3.2461 3.0938 3.2461 1.5527 0 2.6777-.8262 2.8652-2.0567h-1.5703zM44.5059 19.3262c1.5996 0 2.3906-.5742 2.9238-2.1856l2.1621-6.4218h-1.8047l-1.3301 4.9101h-.0351l-1.336-4.9101h-1.875l2.1856 6.2871c.0058.0234-.0586.2753-.0586.2988-.1172.498-.4277.6973-1.0488.6973-.0645 0-.375 0-.4336-.0118v1.3184c.0586.0117.5859.0176.6504.0176zM53.957 17.0996c1.5821 0 2.5489-1.2187 2.5489-3.2402 0-2.0274-.9727-3.2403-2.5547-3.2403-.8965 0-1.5938.4454-1.9395 1.1895h-.0351V8.54492h-1.711V17h1.6875v-1.0781h.0352c.3457.7324 1.0488 1.1777 1.9687 1.1777zm-.5918-5.1094c.8496 0 1.3887.7266 1.3887 1.8692 0 1.1484-.5332 1.8633-1.3887 1.8633-.832 0-1.3945-.7266-1.3945-1.8633 0-1.125.5684-1.8692 1.3945-1.8692zM59.8223 15.8633c-.5801 0-.9668-.293-.9668-.7617 0-.4454.3633-.7325 1.0019-.7793l1.3242-.0821v.4571c0 .6797-.6152 1.166-1.3593 1.166zm-.5625 1.2363c.7851 0 1.5644-.3926 1.916-1.0605h.0351V17h1.6524v-4.3184c0-1.2656-1.0488-2.0976-2.6602-2.0976-1.664 0-2.7011.8379-2.7656 2.0566h1.5645c.082-.4629.4863-.7793 1.125-.7793.6445 0 1.0546.3399 1.0546.9258v.416l-1.582.0938c-1.5644.0937-2.4434.7558-2.4434 1.8984 0 1.1309.9083 1.9043 2.1036 1.9043zM63.8652 12.5645c0 .9433.6153 1.5527 1.8282 1.8105l1.0722.2227c.6153.1406.8321.3281.8321.6621 0 .4101-.3985.6738-1.043.6738-.6797 0-1.0723-.293-1.1777-.8438h-1.67c.1114 1.2364 1.1133 2.045 2.8477 2.045 1.6172 0 2.748-.8145 2.748-2.0508 0-.9199-.539-1.4356-1.8515-1.711l-1.0723-.2285c-.6328-.1347-.8672-.3515-.8672-.6738 0-.416.3926-.6855.9844-.6855.6328 0 1.0137.3457 1.0664.8554h1.5762c-.0352-1.2304-1.0313-2.0566-2.6426-2.0566-1.5996 0-2.6309.7851-2.6309 1.9805zM72.9648 11.8496c.7618 0 1.2832.5508 1.3184 1.3535h-2.666c.0586-.7851.5976-1.3535 1.3476-1.3535zm1.3418 3.2285c-.1582.4805-.6386.791-1.2656.791-.873 0-1.4414-.6152-1.4414-1.5117v-.1054h4.3301v-.5215c0-1.9102-1.1543-3.1465-2.9824-3.1465-1.8575 0-3.0293 1.3008-3.0293 3.3047 0 2.0097 1.1601 3.2461 3.0937 3.2461 1.5528 0 2.6778-.8262 2.8653-2.0567h-1.5704zM8.01367 31h1.71094v-4.9922h1.20699V24.748H9.68359v-.416c0-.4453.2461-.6914.80861-.6914.1699 0 .3398.0117.4629.0352v-1.1309c-.1992-.041-.5567-.0761-.8731-.0761-1.48825 0-2.06833.5742-2.06833 1.8046v.4746H7.1582v1.2598h.85547V31zM14.541 31.1348c1.8985 0 3.1113-1.2129 3.1113-3.2813 0-2.039-1.2304-3.2695-3.1113-3.2695-1.8808 0-3.1113 1.2363-3.1113 3.2695 0 2.0625 1.2129 3.2813 3.1113 3.2813zm0-1.3067c-.8437 0-1.3769-.709-1.3769-1.9687 0-1.2481.5449-1.9688 1.3769-1.9688s1.3711.7207 1.3711 1.9688c0 1.2597-.5332 1.9687-1.3711 1.9687zM18.5371 31h1.7109v-3.5098c0-.8847.4922-1.4004 1.336-1.4004.2461 0 .4805.0411.6211.0997v-1.5059c-.1172-.0352-.2871-.0645-.4863-.0645-.7383 0-1.2715.4336-1.4942 1.2305h-.0351v-1.1308h-1.6524V31zM25.2871 31h1.7109v-3.791c0-.7031.4395-1.1953 1.0899-1.1953.6328 0 1.0137.3984 1.0137 1.0722V31h1.6464v-3.8145c0-.6972.4278-1.1718 1.0782-1.1718.6621 0 1.0254.3984 1.0254 1.125V31h1.7109v-4.2891c0-1.2656-.8262-2.1093-2.0566-2.1093-.92 0-1.67.498-1.9512 1.289h-.0352c-.2109-.8203-.8437-1.289-1.7519-1.289-.8555 0-1.5293.498-1.793 1.2539h-.0351v-1.1367h-1.6524V31zM38.0723 29.8633c-.5801 0-.9668-.293-.9668-.7617 0-.4454.3633-.7325 1.0019-.7793l1.3242-.0821v.4571c0 .6797-.6152 1.166-1.3593 1.166zm-.5625 1.2363c.7851 0 1.5644-.3926 1.916-1.0605h.0351V31h1.6524v-4.3184c0-1.2656-1.0488-2.0976-2.6602-2.0976-1.664 0-2.7011.8379-2.7656 2.0566h1.5645c.082-.4629.4863-.7793 1.125-.7793.6445 0 1.0546.3399 1.0546.9258v.416l-1.582.0938c-1.5644.0937-2.4434.7558-2.4434 1.8984 0 1.1309.9083 1.9043 2.1036 1.9043zM47.9277 27.0566c-.0761-1.4238-1.1543-2.4726-2.8535-2.4726-1.8808 0-3.082 1.2539-3.082 3.2695 0 2.0508 1.2012 3.2813 3.0937 3.2813 1.6524 0 2.7598-.9551 2.8477-2.4375h-1.5938c-.1054.6855-.5507 1.0957-1.2363 1.0957-.8496 0-1.3769-.7032-1.3769-1.9395 0-1.2129.5273-1.9277 1.3711-1.9277.7031 0 1.1425.4687 1.2421 1.1308h1.5879zM52.7207 22.3984c-2.5078 0-4.0781 1.6817-4.0781 4.377 0 2.6894 1.5703 4.3711 4.0781 4.3711 2.502 0 4.0781-1.6817 4.0781-4.3711 0-2.6953-1.5761-4.377-4.0781-4.377zm0 1.4766c1.3828 0 2.2676 1.125 2.2676 2.9004 0 1.7695-.8848 2.8887-2.2676 2.8887-1.3887 0-2.2734-1.1192-2.2734-2.8887 0-1.7754.8906-2.9004 2.2734-2.9004zM57.6191 28.5859c.0528 1.5938 1.3946 2.5606 3.4102 2.5606 2.1152 0 3.4102-1.0488 3.4102-2.7012 0-1.2832-.7793-2.0039-2.5665-2.3613l-.8964-.1817c-.9961-.1992-1.4063-.5214-1.4063-1.0429 0-.6211.5859-1.0313 1.459-1.0313.8906 0 1.5176.4336 1.5762 1.1543h1.6699c-.0293-1.5527-1.2715-2.584-3.2461-2.584-1.8809 0-3.2285 1.0254-3.2285 2.5723 0 1.2598.8262 2.0684 2.5137 2.4023l.8906.1758c1.0605.2168 1.459.5332 1.459 1.0899 0 .6211-.6446 1.0781-1.5879 1.0781-.961 0-1.6758-.4219-1.7871-1.1309h-1.67zM94.7091 29.5758c-.4611-.2895-.8705-.644-1.2126-1.0535-.3734-.4242-.7194-.8703-1.0372-1.3321-.7466-1.026-1.3305-2.1483-1.7351-3.331C90.2369 22.4831 90 21.1657 90 19.8767c0-1.4383.3314-2.6934.9767-3.7469.4776-.8246 1.1892-1.5144 2.047-1.999.8285-.4856 1.7936-.7513 2.7683-.7696.3412 0 .7116.0458 1.1015.1374.2827.0733.6238.1924 1.043.339.5361.1924.8285.3115.926.339.3119.1099.5751.1557.7798.1557.156 0 .3797-.0458.6287-.1191.141-.0458.409-.1282.79-.284.376-.1283.674-.2382.911-.3206.361-.1008.71-.1924 1.023-.2382.381-.055.758-.0733 1.12-.0458.692.0458 1.325.1832 1.891.3847.994.3757 1.796.962 2.395 1.7957-.254.1465-.488.3169-.707.5038-.475.394-.877.8612-1.199 1.3788-.419.7054-.634 1.5025-.628 2.3087.015.9921.283 1.8643.819 2.6201.377.5497.881 1.0206 1.495 1.4072.302.1924.568.3252.819.4122-.117.3436-.246.678-.395 1.0078-.338.7393-.741 1.4475-1.218 2.1162-.421.5772-.753 1.0078-1.004 1.2918-.392.4397-.77.7695-1.15 1.005-.42.2611-.912.3994-1.416.3994-.341.0138-.682-.0275-1.008-.1163-.282-.0871-.561-.1851-.834-.2959-.286-.1228-.581-.2272-.882-.3115-.371-.0916-.751-.1356-1.1349-.1347-.3899 0-.77.0458-1.1307.1328-.3022.0807-.5946.1796-.8841.2978-.4094.1603-.6774.2657-.8334.3115-.3158.0879-.6395.1411-.965.1603-.5069 0-.9787-.1374-1.4485-.4123l.0127-.0119zM101.39 12.664c-.663.3115-1.292.4434-1.9231.3995-.0975-.5919 0-1.2002.2631-1.8662.234-.568.546-1.081.975-1.5391.448-.47639.984-.87033 1.589-1.15433.643-.31148 1.257-.47639 1.842-.50387.078.62297 0 1.23678-.244 1.89639-.222.58631-.553 1.12681-.974 1.61241-.425.4764-.951.8703-1.546 1.1543l.018.0009z"/>
</svg>
        </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, iOS, Linux, and Windows</a>
</template>

<template id="link-windows">
    <a href="https://keybase.io/docs/the_app/install_windows" class="download__button" aria-label="Download Keybase">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 40">
    <path fill="var(--color--content__text)" d="M0 0h120v40H0z"/>
    <path fill="var(--color--content__background)" d="M1 1h118v38H1z"/>
    <path fill="var(--color--content__text)" d="M17.3 13.4v-1h-3.6v1.4h1.8v.1c0 1-.8 1.8-2 1.8-1.4 0-2.3-1.1-2.3-3 0-1.8.9-2.8 2.3-2.8 1 0 1.7.5 2 1.4h1.7c-.3-1.7-1.8-2.9-3.7-2.9-2.5 0-4 1.6-4 4.3 0 2.8 1.5 4.4 4 4.4 2.4 0 3.8-1.3 3.8-3.7zM21.1 11.8c.8 0 1.3.6 1.3 1.4h-2.6c0-.8.6-1.4 1.3-1.4zm1.3 3.3c-.1.5-.6.8-1.2.8-.9 0-1.5-.6-1.5-1.5v-.1h4.4v-.6c0-1.9-1.2-3.1-3-3.1-1.9 0-3 1.3-3 3.3 0 2 1.1 3.2 3 3.2 1.6 0 2.7-.8 3-2h-1.7zM25.4 9.3v1.4h-.9V12h1v3.3c0 1.2.5 1.7 2 1.7h.8v-1.3h-.4c-.5 0-.8-.2-.8-.7v-3h1.2v-1.3H27V9.3h-1.7zM33.5 17v-2.6l.8-1 2.5 3.6H39l-3.3-4.7 3.1-3.8h-2l-3.1 3.9V8.5h-1.9V17h1.8z"/>
    <path fill="var(--color--content__text)" d="M42 11.8c.7 0 1.2.6 1.3 1.4h-2.7c0-.8.6-1.4 1.3-1.4zm1.3 3.3c-.2.5-.7.8-1.3.8-.9 0-1.4-.6-1.4-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3 3.2 1.6 0 2.8-.8 3-2h-1.6zM46.5 19.3c1.6 0 2.4-.5 3-2.2l2-6.4h-1.7l-1.3 5-1.4-5h-1.9l2.2 6.3v.3c-.2.5-.5.7-1.1.7h-.4v1.3h.6zM56 17.1c1.5 0 2.5-1.2 2.5-3.2s-1-3.3-2.5-3.3a2 2 0 00-2 1.2V8.5h-1.7V17H54v-1a2 2 0 002 1.1zm-.6-5.1c.8 0 1.4.7 1.4 1.9 0 1.1-.6 1.8-1.4 1.8-.9 0-1.4-.7-1.4-1.8 0-1.2.5-2 1.4-2zM61.8 15.9c-.6 0-1-.3-1-.8 0-.4.4-.7 1-.8h1.4v.4c0 .7-.6 1.2-1.4 1.2zm-.5 1.2c.7 0 1.5-.4 1.9-1v.9H65v-4.3c0-1.3-1-2.1-2.7-2.1-1.7 0-2.7.8-2.8 2H61c0-.4.5-.7 1.1-.7.7 0 1 .3 1 .9v.4l-1.5.1c-1.6 0-2.4.8-2.4 1.9 0 1.1.9 1.9 2 1.9zM65.9 12.6c0 1 .6 1.5 1.8 1.8l1 .2c.7.1.9.3.9.7 0 .4-.4.6-1 .6-.7 0-1.1-.3-1.2-.8h-1.7c.1 1.2 1.1 2 2.9 2 1.6 0 2.7-.8 2.7-2 0-1-.5-1.5-1.8-1.7l-1.1-.3c-.7 0-.9-.3-.9-.6 0-.4.4-.7 1-.7s1 .3 1 .8h1.6c0-1.2-1-2-2.6-2s-2.6.8-2.6 2zM75 11.8c.7 0 1.2.6 1.3 1.4h-2.7c0-.8.6-1.4 1.4-1.4zm1.3 3.3c-.2.5-.6.8-1.3.8-.8 0-1.4-.6-1.4-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3.1 3.2 1.6 0 2.7-.8 2.9-2h-1.6zM10 31h1.7v-5H13v-1.3h-1.2v-.4c0-.4.2-.7.8-.7h.5v-1a5 5 0 00-1-.1c-1.4 0-2 .5-2 1.8v.4h-.8V26h.8v5zM16.5 31.1c2 0 3.2-1.2 3.2-3.2s-1.3-3.3-3.2-3.3c-1.8 0-3 1.2-3 3.3 0 2 1.1 3.2 3 3.2zm0-1.3c-.8 0-1.3-.7-1.3-2 0-1.2.5-2 1.3-2 .9 0 1.4.8 1.4 2 0 1.3-.5 2-1.4 2zM20.5 31h1.7v-3.5c0-.9.5-1.4 1.4-1.4h.6v-1.4h-.5c-.7 0-1.3.4-1.5 1.1v-1h-1.7V31zM32.5 25.2l1.7 5.8h1.6l2.3-8.5h-1.9L35 28.7l-1.6-6.2h-1.5l-1.6 6.2-1.4-6.2H27l2.2 8.5H31l1.6-5.8zM39 31h1.6v-6.3H39V31zm.8-7.1c.5 0 .8-.4.8-1 0-.4-.3-.8-.8-.8a.9.9 0 100 1.8zM41.8 31h1.7v-3.6c0-.8.5-1.4 1.2-1.4.8 0 1.2.5 1.2 1.3V31h1.7v-4c0-1.5-.8-2.4-2.2-2.4-1 0-1.6.5-2 1.2v-1h-1.6V31zM51 31.1a2 2 0 002-1.2V31h1.7v-8.5H53v3.3a2 2 0 00-2-1.2c-1.6 0-2.6 1.3-2.6 3.2 0 2 1 3.3 2.6 3.3zm.6-5.1c.8 0 1.4.7 1.4 1.9 0 1.1-.6 1.8-1.4 1.8-.9 0-1.4-.7-1.4-1.8 0-1.2.5-2 1.4-2zM58.7 31.1c1.9 0 3.1-1.2 3.1-3.2s-1.2-3.3-3-3.3c-2 0-3.2 1.2-3.2 3.3 0 2 1.2 3.2 3.1 3.2zm0-1.3c-.8 0-1.4-.7-1.4-2 0-1.2.6-2 1.4-2 .8 0 1.4.8 1.4 2 0 1.3-.6 2-1.4 2zM71.5 24.7h-1.7l-1 4.7-1.1-4.7H66L65 29.4l-1-4.7h-1.7l1.7 6.3h1.8l1.1-4.4L68 31h1.8l1.7-6.3zM72 26.6c0 1 .6 1.5 1.8 1.8l1 .2c.7.1 1 .3 1 .7 0 .4-.5.6-1.1.6-.7 0-1.1-.3-1.2-.8h-1.7c.1 1.2 1.1 2 2.9 2 1.6 0 2.7-.8 2.7-2 0-1-.5-1.5-1.8-1.7l-1.1-.3c-.6 0-.9-.3-.9-.6 0-.4.4-.7 1-.7s1 .3 1 .8h1.7c0-1.2-1-2-2.7-2-1.6 0-2.6.8-2.6 2zM88 12.2l9-1.3v8.7h-9v-7.4zm10-1.4L110 9v10.4H98v-8.6zm-10 9.8h9v8.6L88 28v-7.4zm10 0h12V31l-11.8-1.7"/>
</svg>
        </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, iOS, Linux, and Mac OS</a>
</template>


<template id="link-unknown">
  <a href="https://keybase.io/download" class="download__button" aria-label="Download Keybase">
  <svg viewBox="0 0 118 38" xmlns="http://www.w3.org/2000/svg">
    <rect stroke="var(--color--content__text)" fill="none"  x=".5" y=".5" width="117" height="37" rx="4.5"/>
    <path fill="var(--color-content__text)" d="M27.7 25.6a1 1 0 00-.9.6 1 1 0 00.7 1.3 1 1 0 001-.4 1 1 0 00-.8-1.5zm5.7-7.6a11 11 0 00-5.4-4.2 4 4 0 00-2.4-5.3 5 5 0 00-1.7-.3c0-.1-.1-.6.5-1.8l-1.2-.7-.3.3-1.2 1.8h-.5l-2-.1c-2.7 0-2.7 2.7-2.7 2.3v2c-.2 1.3 1 2.5 2.4 2.6h.4a11 11 0 00-2.4 1.9c-3.2 3.2-3.2 6.8-3.2 9.7v1.7l1.2-1.5c.2.7.4 1.3.8 2 .3.5.7.4 1 .3.2 0 .5-.3.2-1-.4-.9-.7-1.8-.8-2.8l2.4-3-1.3 3.8c3-2.2 8-3.2 12.1-2 1.8.5 3.5 0 4.4-1.2v-.2c.2.5.2 1 .2 1.5a12 12 0 01-.8 4.2c0 .3.1.7.5.8.4 0 .8-.2 1-.6.4-1.3.7-2.8.7-4.4 0-2-.7-4-1.9-5.8zm-13-7.4h-.9v1.1h.6v1H19a.6.6 0 01-.6-.7v-1.9c.1-.6.8-.5.8-.5h1.5l-.4 1zm7.5 9a.5.5 0 01-.7-.1l-.5-.6-1.8 1.4a.4.4 0 01-.5 0l-.9-1a.4.4 0 01.1-.6l1.8-1.4-.7-.9-1 .7a.4.4 0 01-.5 0l-.2-.2a.4.4 0 01.1-.6l.9-.7-1-1.1a.5.5 0 01.1-.7.5.5 0 01.8 0l4.1 5a.5.5 0 010 .7zm-5.3 6a1 1 0 00-.8.6 1 1 0 00.6 1.3 1 1 0 001-.4 1 1 0 00-.8-1.5z"/>
    <path fill="var(--color-content__text)" d="M49.7 15V8.3h2.4c.5 0 1 .1 1.4.3a3.1 3.1 0 011.8 1.7 3.5 3.5 0 010 2.7 3 3 0 01-1.8 1.8l-1.4.2h-2.4zm2.4-.9c.4 0 .8 0 1-.2.4-.1.6-.3.8-.5l.5-.8.1-1-.1-.9a2.2 2.2 0 00-1.2-1.3l-1-.2h-1.5v5h1.4zm6.8 1c-.4 0-.7 0-1-.2l-.8-.5-.5-.8a2.8 2.8 0 01.5-2.8A2.3 2.3 0 0159 10c.4 0 .7.1 1 .3.3 0 .6.3.8.5l.5.8.2 1-.2 1-.5.8-.8.5c-.3.2-.6.2-1 .2zm0-.8l.7-.1.4-.4.3-.6a2.2 2.2 0 000-1.3c0-.2-.2-.4-.3-.5a1.4 1.4 0 00-1-.6l-.7.2c-.2 0-.4.2-.5.4l-.3.5v1.4c0 .2.2.3.3.5a1.4 1.4 0 001.1.5zm7.8.7l-1.2-3.7-1.2 3.7h-1L62 10.2h.9l1 3.7 1.3-3.7h.8l1.2 3.7 1-3.7h1L67.6 15h-1zm6.5 0v-3c0-.5-.1-.8-.3-1l-.7-.2c-.3 0-.6.1-.8.3l-.6.5V15H70v-4.8h1v.7a2 2 0 01.6-.6 2.2 2.2 0 011-.3c.6 0 1 .2 1.2.4.3.3.4.7.4 1.2V15h-1zm2.3 0V8.3h1V15h-1zm4.5.1c-.4 0-.7 0-1-.2l-.8-.5-.5-.8a2.8 2.8 0 01.5-2.8A2.3 2.3 0 0180 10c.4 0 .7.1 1 .3.3 0 .6.3.8.5l.5.8.1 1-.1 1-.5.8-.8.5c-.3.2-.6.2-1 .2zm0-.8l.6-.1.5-.4.3-.6a2.2 2.2 0 000-1.3c0-.2-.2-.4-.3-.5a1.4 1.4 0 00-1.1-.6l-.6.2c-.2 0-.4.2-.5.4l-.3.5-.1.7v.7l.4.5a1.4 1.4 0 001 .5zm6.6.7v-.5a2 2 0 01-.7.5l-1 .1h-.5l-.6-.4a1.5 1.5 0 01-.5-1.2l.1-.7.4-.5.6-.3h.6l.9.1.7.5v-.8c0-.3-.2-.6-.4-.7-.2-.2-.5-.3-.8-.3a2 2 0 00-1.5.7l-.4-.7c.6-.5 1.2-.8 2-.8l.8.1a1.6 1.6 0 011 .9l.2.7V15h-1zm-1.3-.5c.3 0 .5 0 .7-.2.2 0 .4-.2.6-.4v-.8l-.6-.4-.7-.1c-.3 0-.6 0-.8.2-.2.2-.3.4-.3.7 0 .3.1.6.3.7.2.2.5.3.8.3zm7 .5v-.7c-.1.3-.4.4-.7.6l-.8.2c-.4 0-.6 0-1-.2a2 2 0 01-.6-.5l-.4-.8-.2-1c0-.4 0-.7.2-1 0-.4.2-.6.4-.9a2 2 0 011.6-.6c.3 0 .6 0 .8.2.3.1.5.3.7.6V8.3h1V15h-1zm-1.3-.7c.3 0 .5 0 .8-.2l.5-.5v-2c0-.2-.3-.4-.5-.5a1.5 1.5 0 00-1.4-.1c-.2 0-.3.2-.5.3l-.3.6v1.4l.3.5a1.3 1.3 0 001.1.5zM55.5 29l-2.9-3.7-.7.8V29h-2v-9.3h2v4.1l3.3-4.1h2.5L54 24l4 5h-2.5zm6 .2c-.4 0-1-.1-1.4-.3l-1.1-.7a3.4 3.4 0 01-1-2.6c0-.5 0-1 .2-1.4a3.5 3.5 0 011.9-1.8 3.5 3.5 0 012.7 0c.5.1.8.4 1.1.7.3.3.5.7.7 1.2.2.4.3 1 .3 1.5v.4h-5c0 .4.2.8.5 1 .3.4.8.6 1.4.6a2.8 2.8 0 001.8-.7l.8 1.1c-.4.3-.8.6-1.3.7a5 5 0 01-1.5.3zm1.6-4.2v-.5l-.4-.5-.5-.4-.7-.1-.8.1-.5.4-.3.5-.1.5h3.3zm3 5l.3.1H67.3l.4-.4.2-.6-2.7-6.9H67l1.7 4.7 1.8-4.7h2l-3.3 8c-.2.5-.6 1-1 1.2a3.4 3.4 0 01-2 .3H66l.3-1.6zm9-3.2l.7.6.8.2c.5 0 1-.2 1.3-.5.3-.4.4-.9.4-1.5s-.1-1-.4-1.4c-.3-.4-.8-.5-1.3-.5-.3 0-.6 0-.8.2-.3.1-.6.3-.7.5v2.4zM73.3 29v-9.3h1.8V23a2.6 2.6 0 012-1 2.8 2.8 0 012.2 1c.3.2.5.6.7 1l.2 1.5c0 .6-.1 1-.3 1.5-.1.5-.3.8-.6 1.1-.3.3-.6.6-1 .7a3 3 0 01-1.1.3l-1.2-.3-1-.8v.9h-1.7zm12.3 0v-.7c-.3.3-.6.5-1 .6-.3.2-.7.3-1.2.3a2.6 2.6 0 01-1.5-.6c-.3-.2-.5-.4-.6-.7l-.2-1c0-.4 0-.7.2-1 .1-.3.3-.5.6-.7.2-.1.4-.3.7-.3l.8-.2c.5 0 .9.1 1.3.3.4 0 .7.3.9.6v-1a1 1 0 00-.4-.8c-.3-.2-.7-.3-1.1-.3-.8 0-1.4.3-2 .8l-.7-1.2a4 4 0 011.4-.8 4.8 4.8 0 012.7-.1c.4 0 .7.2 1 .4l.6.8c.2.3.3.7.3 1.2V29h-1.8zm-1.4-1c.2 0 .5 0 .8-.2.2 0 .4-.2.6-.4v-.9l-.6-.4-.8-.2c-.4 0-.7.1-1 .3-.2.2-.3.4-.3.8 0 .3.1.5.3.7.3.2.6.3 1 .3zm7.4 1.2c-.6 0-1.2-.1-1.7-.3-.6-.2-1-.5-1.4-.8l.8-1.2.5.3.5.3.7.2.6.1c.4 0 .7 0 .9-.2.2-.1.3-.3.3-.5l-.1-.3-.3-.2-.5-.1a15.9 15.9 0 00-1.4-.4c-.3 0-.6-.2-.8-.3l-.7-.6c-.2-.3-.2-.6-.2-1l.1-.8.6-.7.8-.4c.4-.2.8-.2 1.2-.2.6 0 1.1 0 1.6.2l1.2.7-.8 1.2c-.2-.2-.4-.4-.8-.5-.4-.2-.7-.3-1.2-.3-.3 0-.5 0-.7.2-.2.2-.3.3-.3.5s0 .3.3.4l1 .3c.3 0 .6 0 .9.2l.9.3.6.7c.2.2.3.6.3 1 0 .3 0 .6-.2.9a2 2 0 01-.6.7l-.9.4-1.2.2zm7.4 0l-1.5-.3-1.1-.7a3.4 3.4 0 01-1-2.6c0-.5 0-1 .2-1.4a3.5 3.5 0 011.8-1.8 3.5 3.5 0 012.8 0c.5.1.8.4 1.1.7.3.3.5.7.7 1.2.2.4.2 1 .2 1.5v.4h-5c0 .4.3.8.6 1 .3.4.8.6 1.4.6a2.8 2.8 0 001.8-.7l.8 1.1c-.4.3-.8.6-1.3.7a5 5 0 01-1.5.3zm1.5-4.2v-.5l-.4-.5-.5-.4-.7-.1-.8.1-.5.4-.3.5-.1.5h3.3z"/>
  </svg>
  </a>
</template>

<div class="download">
  <div class="download__title">Get Keybase</div>
  <p class="download__description">
    Keybase is a safe, secure, and private app for everything you do online.
  </p>
</div>
<script>
let ua = window.navigator.userAgent;
let platform = 'unknown';

if (ua.indexOf('Android') !== -1) { platform = 'android'; }
else if (ua.indexOf('Linux') !== -1) { platform = 'linux'; }
else if (ua.indexOf('Windows') !== -1) { platform = 'windows'; }
else if (ua.indexOf('Win32') !== -1) { platform = 'windows'; }
else if (ua.indexOf('iPhone') !== -1) { platform = 'ios'; }
else if (ua.indexOf('iPad') !== -1) { platform = 'ios'; }
else if (ua.indexOf('Mac OS') !== -1) { platform = 'mac'; }

let temp = document.querySelector('#link-' + platform);
let clone = temp.content.cloneNode(true);

document.querySelector("div.download").appendChild(clone);
</script>
    <span class="site-footer__copyright">(C) Keybase — 2022</span>
    <span class="site-footer__disclaimer">Keybase Book is <a href="https://github.com/keybase/book-content/">open source</a>.</span>
  </div>
</footer>
  </body>
</html>