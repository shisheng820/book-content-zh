<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Keybase Book: </title>
    <meta name="description" content="" />
    <meta name="robots" content="index,follow" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="/static/css/custom.css" />

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/favicon/site.webmanifest">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#030303">
    <meta name="msapplication-TileColor" content="#f0f0f0">
    <meta name="theme-color" content="#f0f0f0">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@KeybaseIO">
    <meta name="twitter:creator" content="@KeybaseIO">
    <meta name="twitter:title" content="Keybase Book">
    <meta name="twitter:description" content="Use Keybase for end-to-end encrypted chat messaging, file sharing, and team collaboration. Get the free app for iOS, Mac, Android, Windows, and Linux.">
    <meta name="twitter:image" content="/static/img/twitter-card.jpg">

    <script>
    function url_for(filename) {
        const prefix = "";
        const STATIC_ASSET_MAP = {};

        if (STATIC_ASSET_MAP.hasOwnProperty(filename)) {
            return prefix + STATIC_ASSET_MAP[filename] + "/" + filename;
        }

        return prefix + filename;
    }
    </script>
  </head>
  <body>

    <div class="app">
      <nav class="site-nav">
            <a class="site-nav__brand" href="/">Keybase&nbsp;<span>Book</span></a>
            
            <div class="site-nav__actions">
                
                <a class="site-nav__jump site-nav__jump--primary" href="https://book.keybase.io/docs/crypto/kbfs" target="_blank">查看原版</a>
                <a class="site-nav__jump" href="https://keybase.io">前往 keybase.io</a>
            </div>
        </nav>
      <main class="main">
        
    <div class="content">
        
        <div class="side-nav side-nav--extended">
        <nav class="chapter-nav">
            <p class="chapter-nav__label">文档</p>
            <ol class="chapter-nav__list">
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/cli" class="chapter-nav__link">命令行 (Command Line)</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/server" class="chapter-nav__link">服务器 (Server)</a>
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/teams" class="chapter-nav__link">团队</a>
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/chat" class="chapter-nav__link">Chat</a>
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/files" class="chapter-nav__link">Introducing the Keybase Filesystem</a>
                        
                    </li>
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/wallet" class="chapter-nav__link">Stellar Wallet Key Management</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/crypto" class="chapter-nav__link chapter-nav__link--active">Keybase Crypto Documents</a>
                        
                            
                            
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                                    
                                
                            
                                
                                    
                                
                            
                                
                                    
                                
                            
                                
                                    
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                                
                            
                            
                                <ol class="chapter-nav__nested-list">
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/key-exchange" class="chapter-nav__nested-link">Keybase Key Exchange (KEX) Protocol</a>
                                    </li>
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/local-key-security" class="chapter-nav__nested-link">Local Key Security</a>
                                    </li>
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/kbfs" class="chapter-nav__nested-link">Crypto spec: the Keybase filesystem (KBFS)</a>
                                    </li>
                                    
                                    <li class="chapter-nav__nested-list-item">
                                        <a href="/docs/crypto/_account-corner-cases" class="chapter-nav__nested-link">Keybase Account Corner Cases (Plan)</a>
                                    </li>
                                    
                                </ol>
                            
                        
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/bots" class="chapter-nav__link">Bots</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/linux" class="chapter-nav__link">Linux User Guide</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/lockdown" class="chapter-nav__link">Lockdown Mode</a>
                        
                    </li>
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/client" class="chapter-nav__link">Keybase client-side architecture</a>
                        
                    </li>
                    
                
                    
                
                    
                    <li class="chapter-nav__list-item">
                        
                        <a href="/docs/sites" class="chapter-nav__link">Keybase.pub</a>
                        
                    </li>
                    
                
                    
                
                    
                
            </ol>
            <a href="/account" class="chapter-nav__back">返回章节列表</a>
        </nav>
    </div>
        
        <div class="content__inner">
            <section id="overview" class="content__section">
                <style>
body .kbfs-crypto-spec {
  counter-reset: h2counter;
}
.kbfs-crypto-spec h1 {
  counter-reset: h2counter;
}
.kbfs-crypto-spec h2:before {
  content: counter(h2counter) ".\0000a0\0000a0";
  counter-increment: h2counter;
}
.kbfs-crypto-spec h2 {
  counter-reset: h3counter;
}
.kbfs-crypto-spec h3:before {
  content: counter(h2counter) "." counter(h3counter) ".\0000a0\0000a0";
  counter-increment: h3counter;
}
.kbfs-crypto-spec h3 {
  counter-reset: h4counter;
}
.kbfs-crypto-spec h4:before {
  content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) ".\0000a0\0000a0";
  counter-increment: h4counter;
}
.kbfs-crypto-spec h4 {
  counter-reset: h5counter;
}
.kbfs-crypto-spec h5:before {
  content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) ".\0000a0\0000a0";
  counter-increment: h5counter;
}
.kbfs-crypto-spec p.note {
  font-size: 0.4em;
}
</style>

<div class="kbfs-crypto-spec">
  <h1>Crypto spec: the Keybase filesystem (KBFS)</h1>

  <md>
    See also: [KBFS documentation](/docs/kbfs)
  </md>

  <p>Version 2.0</p>
  <p><strong>ChangeLog</strong></p>
  <ul>
    <li>Version 2.0
      <ul>
        <li>Describe the new block encryption/hashing scheme, addressing the low-risk issue NCC-KB2018-005 in the <a href="https://keybase.io/docs-assets/blog/NCC_Group_Keybase_KB2018_Public_Report_2019-02-27_v1.3.pdf">NCC audit</a>.  We will eventually stop supporting new blocks being generated with the old scheme.</li>
      </ul>
    </li>
    <li>Version 1.10
      <ul>
        <li>Point to new teams documentation.</li>
      </ul>
    </li>
    <li>Version 1.9
      <ul>
        <li>Temporarily remove talk of orgs while we refactor the doc.</li>
      </ul>
      </li>
    <li>Version 1.8
      <ul>
        <li>More details and dates for the KBFS Merkle Trees.</li>
      </ul>
      </li>
    <li>Version 1.7
    <ul>
      <li>A threat model</li>
    </ul>
    </li>
    <li>Version 1.6
    <ul>
      <li>Say what's in progress on what's implemented.</li>
      <li>Last writer isn't encrypted.</li>
    </ul>
    </li>
    <li>Version 1.5
      <ul>
        <li>Remove pairwise HMACs, just used signatures.</li>
        <li>Rename file from <tt>crypto</tt> to <tt>kbfs-crypto</tt>.</li>
        <li>Remove browser/deterministic keys.</li>
      </ul>
    </li>
    <li>Version 1.4
      <ul>
        <li>Revert PRF-based per-block key generation</li>
        <li>Raise Jeremy's objection to MAC-ing TLFs with read-only members.</li>
        <li>Provide system overview</li>
        <li>Better key exchange specifics</li>
      </ul>
    </li>
    <li>Version 1.3
      <ul>
        <li>PRF-based per-block key generation system with per-epoch folder keys</li>
        <li>Try to use "TLF" consistently everywhere instead of "folder" or "directory"</li>
      </ul>
    </li>
    <li>Version 1.2
    <ul>
      <li>Describe directory IDs</li>
      <li>Detail \((M_f, m_f)\) generation</li>
    </ul>
    </li>
    <li>Version 1.1
    <ul>
      <li>Organizations</li>
      <li>Readers can push onto reader lists</li>
      <li>Merkle Trees for Public and Private data</li>
    </ul>
    </li>
    <li>Version 1.0: Initial Revision</li>
  </ul>

  <h2>Threat Model and Security Claims</h2>

  <p>
  <strong>End-to-end security</strong>: Keybase promises secrecy and integrity of
  file system data and metadata even in the case of total server compromise.</p>

  <p>Our key cryptographic assumptions are: (1) weak collision-resistance of SHA256; (2) the
  security of the
  <a href="https://github.com/golang/crypto/tree/master/nacl">Go</a>
  <a href="https://github.com/agl/ed25519">Implementation</a> of the
  <a href="http://nacl.cr.yp.to">NaCl</a> cryptographic library.
  </p>

  <p>
  <strong>Best Effort via Access Control</strong>: If our server infrastructure isn't compromised, we provide only via access control:
  </p>

  <ul>
    <li>Forward-secrecy for lost or decommissioned devices.</li>
    <li>Confidentiality regarding which private folders have data, and which
        are empty.</li>
    <li>Confidentiality for quota data.</li>
  </ul>
  <p>
  In other words, an adversary who has access to Keybase's server data could:
  learn about who is communicating with whom via KBFS; would have the same
  usage details we would eventually use for billing; and would be able to recover data encrypted
  for lost or decommissioned devices, if they additionally recover those devices.
  </p>

  <p>
  Of course we are mere mortals and don't believe we can indefinitely stave off
  concerted attacks against our infrastructure, so we encourage our users to only
  depend on our end-to-end security claims.
  </p>

  <p>Additionally, we don't guarantee availability of data or metadata in the
  case of server compromise.</p>

  <h2>System Overview</h2>

  <p><strong>Sibling keys and subkeys</strong>.
    Each user in Keybase keeps two keypairs per device; one keypair
    for signing, and one pair for encryption.  Secret keys never leave the
    device.  The signing keys are known as "siblings" since they
    all are equally powerful.  Any active sibling key can provision or revoke
    another device.  Subkeys are signed by an active sibling key but can't
    delegate to other keys.  The first of a series of sibling keys is
    called an "eldest" key and can be revoked without affecting its other
    live siblings.
  </p>

  <p><strong>Private Personal Directories</strong>
  Every keybase user gets a private personal directory, keyed so that all
  of her devices can read and write it.
  </p>

  <p><strong>Public Directories</strong>
   Groups of one-or-more users can create public directories.  Items in
   public directories are signed by one of the devices of one of the directory's
   writers; they are not encrypted.  Public directories are good places to release
   software or authenticated manifestos.
  </p>

  <p><strong>Private Group Directories</strong>
    The most interesting case, a group of people with read/write permission
    get together with some other people who have read-only permission to share
    a directory.  This directory should use authenticated encryption to
    guarantee that only someone in the group could have written to it.  It
    should further use some mechanism (currently vanilla signatures) to determine which writer is
    responsible for which write, so that users can't put words in each other's mouths.
  </p>

  <p><strong>Forest of Merkle Trees</strong> [Unimplemented]
    Keybase keeps public Merkle trees for managing: (1) each user's collection of keypairs
    and public identities; and (2) the progression of file system states, so that the
    server can't maliciously roll back to previous states.
  </p>

  <h2>Keys</h2>

  <h3>Eldest Key</h3>

  <p>
    When a user Alice (\(A\)) joins, she starts off by generating or
    importing a keypair.  For our current users, this is a PGP keypair,
    denoted (\(P_A,p_A\)). But there's nothing special about PGP keys,
    and we are free to change the format in the future. We call this keypair
    Alice's <em>eldest</em> keypair, since it's the first among potentially
    many sibling keys.
  </p>

  <h3>Per-Device Keys</h3>
  <p>
    For each of her devices, Alice generates two per-device keypairs.
    The signing key becomes a sibkey, and the encryption keypair is just a
    subkey.
  </p>

  <p>
    For Alice's \(i\)th device, the procedure is:
  </p>

  <ol>

   <li>
    Generate an <a href="http://ed25519.cr.yp.to/">Ed25519</a> <a
    href="https://github.com/agl/ed25519">Keypair</a> at random, yielding the
    pair \((E^i_A, e^i_A)\). In Ed25519, the private key is a 64-byte
    string, and the public key is a 32-byte (derived) string.
   </li>

   <li>
     <a href="https://code.google.com/p/go/source/browse/nacl/box/box.go?repo=crypto&r=8fec09c61d5d66f460d227fd1df3473d7e015bc6#32">Generate</a> a <a href="http://nacl.cr.yp.to/">Curve25519 Keypair</a> suitable for use
     with NaCL's <a href="http://nacl.cr.yp.to/box.html">Box</a> feature (or Go Crypto's <a href="https://code.google.com/p/go/source/browse/nacl/box/box.go?repo=crypto&r=8fec09c61d5d66f460d227fd1df3473d7e015bc6#60">box.Seal</a> feature). Call
     it \((M^i_A,m^i_A)\). In Curve25519
    (Montgomery form), the public and private key are both 32-byte strings.
   </li>

   <li>
    Sign \(E^i_{A}\) with a valid sibling key; and as in PGP, include a "reverse" signature
    of the delegating key, signed by the new key.  Push this <em>sibkey</em> signature
    into Alice's signature chain.  See <a href="key-exchange">our doc</a> on key exchange
    for more specifics.
   </li>

   <li>
     Sign \(M^i_{A}\) with \(e^i_{A}\).  Push this <em>subkey</em>
     signature into Alice's signature chain.
   </li>

   <li>
     Store \(e^i_{A}\) and \(m^i_{A}\) on device \(i\)
   </li>
  </ol>

  <h3>Key IDS (kids)</h3>
  <p>
    Keybase has an idea of a "Key ID".  In the case of PGP keys, it's a hash
    of the public key materials.  In the case of ECC keys, it's the public key
    itself. We describe here how to construct them in Version 1:
  </p>

  <ul>
    <li>For a PGP public key \(P\), compute the serialization \(s(P)\)
    as you would to compute a PGP fingerprint.  Let \(t\) be the one-byte type
    of the key in question. For example, or RSA, \(t = 1\); for DSA \(t = 17\).
    See <a href="http://tools.ietf.org/html/rfc4880#section-9.1">RFC 4880</a> and <a href="http://tools.ietf.org/html/rfc6637#section-5">RFC 6637</a> for a complete list.
    Then:
      <blockquote>
        kid(\(P\)) = <tt>0x01</tt> || \(t\) || SHA-256(\(s(P)\)) || <tt>0x0a</tt>
      </blockquote>
    </li>
    <li>For a NaCl encryption key, \(E\):
      <blockquote>
        kid(E) = <tt>0x01</tt> || <tt>0x21</tt> || E || <tt>0x0a</tt>
      </blockquote>
    </li>
    <li>For a NaCl EDDSA key, \(M\):
      <blockquote>
        kid(M) = <tt>0x01</tt> || <tt>0x20</tt> || M || <tt>0x0a</tt>
      </blockquote>
    </li>
  </ul>

  <h2>Top-Level Folder (TLFs) in KBFS</h2>

  <p>
  A top-level folder (TLF) in KBFS has a fixed set of readers and writers, as specified by
  the name of the folder.  Every file and folder recursively contained in a TLF has
  the same permissions as its parent.  This organization will feel a little bit different from normal
  POSIX semantics, but greatly simplifies the system.
  </p>

  <h3>Private TLFs</h3>
  <p>
    We cover the case of private TLFs with multiple readers and writers first, since
    it's the most general. Home directories are a simple subcase of general private
    group TLFs.
  </p>

  <h4>Keying a Private Group TLF</h4>

  <p>
  Let's say Alice (\(A\)) is creating a new TLF for Bob (\(B\))
  and Charlie (\(C\)). Bob has read/write access, and Charlie only gets
  read-only access. Alice keys the folder (call it \(f\)) for all other
  users when she creates it. The procedure is as follows:
  </p>
  <ol>
    <li>Generate a random 15-byte directory ID, with the suffix <tt>0x16</tt></li>
    <li>Generate a per-TLF Curve25519 DH key pair for inclusion of this folder's
        metadata in the site's private-data Merkle tree; call it \((M_f, m_f)\).
    </li>
    <li>Generate a 32-byte random secret key (version=0 for the first one): \(s^{f,0}\) =
    rand(32)</li>
    <li>Generate an ephemeral Curve25519 Diffie-Helman keypair.  Call it \((M_e,m_e)\).</li>
    <li>For each user \(u\) in \(\{A,B,C\}\):
     <ol>
      <li>For each device \(i\) in \(u\)'s set of devices:
        <ol>
          <li>generate \(s^{f,0,i}_{u} = \) rand(32).
           This will be the server-side half of the key.</li>
           <li>
             \(t^{f,0,i}_{u} = s^{f,0,i}_u \oplus s^{f,0}\).  That is, XOR the global per-TLF key together with the per-user-per-device key to get a masked key.
           </li>
          <li>
            \(S^{f,0,i}_{u} = (M_e, \)Box\((m_e, M^i_u, t^{f,0,i}_u))\).
            That is, run the <a href="http://nacl.cr.yp.to/box.html">NaCl Box</a> function with the ephemeral private key, with the user's public device key,
            and on the message \(t^{f,0,i}_u\).
            This new key \(S^{f,0,i}_u\) can now be published publicly.  It
            can only be decrypted by \(u\)'s private device key, and with some server
            assist (via \(s^{f,0,i}_u\)).  Note that we prepend the public key
            \(M_e\) to the output of Box.  Eventually, we might need to add new keys
            or replace existing keys, and we'll do so with a new ephemeral keypair.  So
            \(M_e\) might eventually be replaced.
          </li>
        </ol>
       </li>
     </ol>
    </li>
    <li>Publish the following metadata (\(md_c\)) in the clear:
      <ol>
        <li>A block of reader keys.  In this case it's just Charlie who is read-only:
            <blockquote>
               readers = \([ S^{f,0,1}_{C}, S^{f,0,2}_{C}, S^{f,0,3}_{C} ]\)
            </blockquote>
        </li>
        <li>
          A block of writer keys.  In this case it's Alice and Bob:
            <blockquote>
               writers = \([ S^{f,0,1}_{A}, S^{f,0,2}_{A}, S^{f,0,1}_{B},S^{f,0,2}_{B} ]\)
            </blockquote>
        </li>
        <li>
          The public key \(M_f\)
        </li>
      </ol>
    </li>
    <li>Some of the metadata is encrypted.  Construct a plaintext \(md_{e}\) as:
      <ol>
        <li>The root TLF block (described more below).</li>
        <li>The private key \(m_f\).</li>
      </ol>
      <p>
      Then, the encryption is computed as: SecretBox(\(s^{f,0}, md_{e}\))
      </p>
    </li>

  </ol>

 <p>
    Note that the server sees reader and writer blocks in the clear, and
    can therefore sanity check updates to them.  For instance, the server
    can check that the readers and writers correspond to the TLF
    name, and that readers and writers aren't being dropped maliciously
    during updates.
  </p>

  <p>
    Similarly, the last writer is known to the server, since the server should
    check the signatures on incoming updates.
  </p>

  <p>
    Writers can obviously update all of the metadata and data for a TLF.
    Readers can change two fields in the folder's metadata: they can push new
    keys onto the end of the reader key list; and they can flip the folder's
    "rekey" bit to "on."  In either case, they sign these changes with any of
    their valid signing sibkeys.  The server and clients can check that all
    updates to metadata are authorized. The server rejects unauthorized
    updates, and clients ignore them.
  </p>

  <h4>Encrypting a Block</h4>

  <p>
    Once she has established keys as above, Alice can start encrypting blocks.
    Take any arbitrary plaintext block like \(b_j\) in TLF \(f\).
    Assume version 0 of the key. To encrypt:
    <ol>
      <li> Generate a random 32-byte per-block key \(s_{j}\).</li>
      <li> Compute \(h_{j} = HMAC512(s^{f,0}, s_{j})\).
      <li> Let \(h^{[0,31]}_{j}\) be the first 32 bytes of \(h_{j}\), to be used as the block encryption key.
      <li> Let \(n\) be the next 24 bytes of \(h_{j}\), to be used as a nonce.
      <li> Compute: \(B_j = \) SecretBox\((h^{[0,31]}_{j}, n, b_j)\)</li>
      <li> For the initial rollout, store \(\{n,s_j\}\) along with \(B_j\) on the
           hosted storage provider.  In the future, we hope to store \(s_{j}\) on machines
           we host to get more secure block deletion.</li>
    </ol>
  </p>

  <p>
    The idea of some sort of per-block key is one we'll want to keep and
    expand upon in the future.  It allows us to be quite liberal in distributing
    encrypted blocks to CDNs and local caches, without fearing that they might
    be never thrown away. If we apply more strict access controls on per-block
    keys \(s_j\), we still retain some ability to throw away blocks, even
    after client key compromise.
  </p>

  <p>
    We're not using convergent encryption or anything like it, so a block that's used twice
    will be encrypted differently both times.  However, clients will keep per-folder caches that
    map hashes of block plaintexts to encrypted block IDs.  So they shouldn't reencrypt/reupload
    blocks they know to be repeats.  In practice, this local lookup might be good enough, since often
    data is read before it's copied, and many block copies will hit this cache.  We don't
    want to allow block deduplication across top-level-directories for privacy reasons.
  </p>

  <h4>FS Structure</h4>

  <p>
    The files in a TLF form a Merkle Tree as in other secure distributed file systems
    (including <a href="https://spqr.eecs.umich.edu/papers/sfsro-tocs.pdf">SFSRO</a>,
     <a href ="https://www.usenix.org/legacy/event/osdi04/tech/full_papers/li_j/li_j.pdf">SUNDR</a>
     and <a href="https://www.tahoe-lafs.org/">Tahoe-LAFS</a>).
    However, KBFS makes the same simplification as the <a href="http://ori.scs.stanford.edu/">ORI File system</a>,
    and does away with iNode-style indirection. Thus, KBFS cannot implement hard-links
    without deeper architectural changes.
  </p>

  <p>
    Block IDs are computed as the SHA-256 hashes of encrypted blocks
    and their nonces.  Using the nonce \({n}\) (which is
    derived from the block's secret key) prevents the server from
    colluding with another writer in the folder to compute another
    combination of secret key and plaintext data that will result in
    the same ciphertext for the block, thus allowing the server to
    serve alternate blocks (with identical block IDs) to some subset
    of readers.  By deriving the nonce from the secret key, we
    guarantee that the block IDs would be different even if the
    attacker found a way to duplicate the ciphertext, and thus the
    attack would be detectable by the client.  For more details, see
    NCC-KB2018-005 in the <a
    href="https://keybase.io/docs-assets/blog/NCC_Group_Keybase_KB2018_Public_Report_2019-02-27_v1.3.pdf">NCC
    audit</a>
  </p>

  <p>
    Directory nodes are, in turn, maps of file names
    to Block IDs.  They are packed as blocks, and get the same
    encryption treatment as data blocks. This structure continues
    recursively up to the TLF root.
  </p>

  <h4>Signing The Root Block</h4>

  <p>
    Readers and writers in a private shared TLF know via authenticated
    encryption that someone who had access to \(s^{f,0}\) wrote \(f\),
    but they don't know who.  Alice can try to steal credit for Bob's work, or
    Bob might frame Alice for saying something naughty.
  </p>

  <p>
    A sledgehammer approach to this problem would be to have Alice sign the
    root block of \(f\) on every update.  But this is too strong of a
    statement. If Eve later compromises Charlie's key, she can blackmail
    Alice, since Alice proved to Bob, Charlie and everyone else that she wrote
    particular contents to \(f\).
  </p>

  <p>
    We experimented with various pairwise symmetric MAC schemes, to achieve
    repudiability as in OTR protocols.  However, such schemes didn't work for
    folders with non-writing readers.  So we do the simple thing which is
    just to sign the hash of the root block with the writer's per-device
    EdDSA signing key.  The same technique is used in all three cases:
    public directories, private directories without non-writing readers,
    and private directories with non-writing readers.
  </p>

  <h3>Public Directories</h3>

  <p>
    If user \(u\) updates a KBFS folder with his \(i\)th device,
    he must sign his changes to the whole folder state by signing its root block.
    This will in effect sign all data and metadata contained recursively in this folder.
  </p>

  <p>To sign, \(u\) computes the complete metadata \(md\)
  as specified above, except without encrypting \(md_e\).  He then signs the block:
    <blockquote>
      \(\sigma(md) = \) Sign(\(e^i_{u},md\))
    </blockquote>
  </p>

  <p>
   The <em>Sign</em> function outputs both the signature, and the KID of the
   key used to generate it.  This way, verifiers know which key to use.
  </p>

  <h3>Home Directories</h3>

  <p>
    As described above, home directories are special cases of TLF group
    directories. When Alice sets up encryption keys for all of her devices,
    she uses the protocol described in 4.1.1, iterating all of her per-device
    keys.  Alice can skip the signing step described in 4.1.3, because she is not
    worried about the "confused authorship" attack, but she still needs to
    sign \(md\) as for public directories to prevent the server from
    spoofing rekeys.
  </p>

  <h2>Keeping the Server Honest</h2>

  <p>
    Unless we're careful, the server can selectively withhold file system updates
    or can serve two different versions of the FS to two different clients.  In
    this section, we describe the precautions we take to prevent these sorts of
    attacks.
  </p>

  <p>
    Our general approach is that the server creates a Merkle Tree out of all
    sensitive site data, then signs and publishes this tree for all to see.
    Third party monitors are invited to check on the progression of the site's
    Merkle trees and to check they obey the specified cryptographic consistency
    constraints.  Clients check their views of the file system with those
    published in the Merkle trees to make sure the server isn't rolling back
    state or attempting a fork.
  </p>

  <p>
    There are three separate Merkle trees to consider: (1) the Keybase Core
    Merkle tree that publicizes sibling keys, public identity proofs, and
    ``follower'' statements;
    (2) a public-data Merkle tree that captures all of the public data on KBFS; and
    (3) a private-data Merkle tree that encapsulates the state of all private data on KBFS.
  </p>

  <h3>The Keybase Core Merkle Tree</h3>

  <p>
    As described in <a href="../server">our
    Server Security</a> document, users sign statements about their keys,
    their identities and the identities of others. They commit these
    signatures to monotonically growing signature chains, which are collected
    into a sitewide Merkle Tree. As we describe later in this document, these
    signature chains will eventually cover organizations in addition to single
    users.  These structure all exist outside of KBFS and should be accessible
    without KBFS software.
  </p>

  <h3>The Public-Data Merkle Tree</h3>

  <p>
    All public directories on KBFS are collected into a sitewide Merkle Tree.
    The leaves of this tree are dictionaries of key-value pairs.  The key
    is the ID of the TLF, and the value is most recent signature of
    the TLF <tt>RootMetadata</tt> block.  This signature contains,
    recursively: the writer keys for this directory, the root directory
    entry for this directory, and the hash of the previous <tt>RootMetadata</tt>
    block.
  </p>

  <p>
    Interior nodes of the merkle tree are constructed upwards, covering shorter
    prefixes of the directory IDs listed in the leaves.  The final root is
    signed, and published periodically, maybe every hour.
  </p>

  <h3>The Private-Data Merkle Tree</h3>

  <p>
    Private data deserves the same treatment as public data, but we have to
    be slightly more careful not to reveal: (1) how often private directories
    are modified; or (2) even worse, who is collaborating with whom.  Naive
    solutions might allow an adversary to correlate device additions in public
    sigchains with changes in private TLFs to correlate share membership.
    We take a pretty blunt approach that should solve data leaks from the server
    to the public.
  </p>

  <p>
    When a user Alice creates private TLF \(f\), she generates a
    Curve25519 keypair \((M_f, m_f)\). She stores \(M_f\) in the folder's
    public metadata, and \(m_f\) in the folder's private metadata.
  </p>

  <p>
    Every hour, the server makes a new Merkle Tree of the entire site's private data.
    The algorithm is:
    <ol>
      <li>Generate an ephemeral Curve25519 keypair \((M_S, m_s)\)</li>
      <li>For each private folder \(f\):
      <ol>
         <li>
         Perform encryption \(C_f \leftarrow\) Box(\(m_s,M_f,\sigma_f\)), where \(\sigma_f\)
         is the most-recent signature of \(f\)'s metadata.
         </li>
         <li>
          Make a mapping of the ID of \(f\) to \(C_f\).
         </li>
      </ol>
      </li>
      <li>
        Construct a Merkle tree from these leaves as in the Public data case, and publish
        the tree along with \(M_s\), the public ephemeral Curve25519 key.
      </li>
    </ol>

  </p>

  <p>
    When Alice's client goes to fetch TLF \(f\), she gets the most recent
    root from the server, and also the most recently-published Merkle tree
    from the server.  She traces a path down the from the root to the leaf for \(f\),
    and then decrypts \(\sigma_f\) using \(m_f\).  She finally checks
    that the current root links back to the root published in the merkle tree.  She might
    of course need to traverse 100s or 1000s of links if there were many writes in the
    last hour, but the server should batch all of the data necessary to make this
    determination in a few RPC calls. Future implementations might also implement
    "skip list"-style fast-forward links to speed this process for periods of heavy
    writes.
  </p>

  <h3>Merkle Tree Integration</h3>

  <p>
    The roots of the two KBFS Merkle trees will be inserted into the root block of
    the main Keybase Merkle Tree.  Doing so establishes ordering relationships between
    key manipulations and writes to KBFS.  In turn, this knowledge allows
    KBFS clients to determine if writes to KBFS happened before or after a key is revoked,
    and therefore whether or not a corrupt server has exploited an exposed key.
  </p>

  <h2>Keying, Rekeying, and Revoking</h2>

  <h3>Adding A New Device</h3>

Imagine Bob gets a new device. He now wants to provision it for access to all
relevant KBFS folders. Here are the high-level steps he would take:

  <ol>
    <li>Key generation</li>
    <li>Key certification: sign the new key with an existing sibling key</li>
    <li>TLF keying: add the key to the relevant reader and writer blocks</li>
  </ol>

The first step, key generation, was covered above, and is the same here.
Key certification is covered in our <a href="key-exchange">key exchange</a>
document.

  <h4>TLF Keying</h4>

  <p>
  Now Bob must go through and add write access for his device on all encrypted
  Keybase directories that he can write. Call his new device \(n\) and
  his old device \(d\). Device \(d\) does the following:
  </p>

  <ol>
    <li>Generate an ephemeral Curve25519 Diffie-Helman keypair.  Call it \((M_e,m_e)\).</li>
    <li>For every TLF \(f\) that Bob can read:
     <ol>
      <li>Use \(m^{d}_{B}\) to decrypt \(t^{f,0,d}_B\)</li>
      <li>Query the server for \(s^{f,0,d}_{B}\) and XOR to recover \(s^{f,0}\)</li>
      <li>Encrypt \(s^{f,0}\) using sender key \(m_e\) and receiver key \(M^{n}_{B}\),
          which was generated on device \(n\) and securely transferred over to \(d\)
          in previous steps.</li>
      <li>
        Add \(S^{f,0,n}_B\) to the writers (or readers) list for \(f\) and
        sign with \(e^{d}_B\)
      </li>
      </ol>
    </li>
  </ol>

  <p>
  Bob pushes \((M_e, S^{f,0,n}_B)\) to TLF \(f\)'s reader or
  writer list.  If he is a reader, he is allowed to push onto the reader list
  in the metadata.  If he is a writer, he can edit \(f\)'s metadata
  at will.
  </p>

  <h3>Freezing a Device [Unimplemented]</h3>

  <p>
  If Alice loses a device \(d\), the first thing to do is to "freeze" access
  to the device via the server.  Any device that can establish a session as the user
  can do so.  Once a device is frozen, the server will refuse to honor requests for
  key-halves of the form \(s^{f,0,d}_{A}\). Any device but \(d\) can
  ask for an unfreeze.
  </p>

  <p>
  Alice can take an additional (optional) step.  She can sign a <em>key freeze</em> into her
  signature chain for each signing key on the lost device.  Other clients should refuse
  to honor signatures from frozen keys during the freeze window.  Alice can later
  cancel the freeze using the same key that ordered the freeze.  The server
  can't assist here, so Alice can only freeze a specific key if she has another provisioned device.
  </p>

  <h3>Decommissioning a Device (And Optionally Adding a New One)</h3>

  <p>
  To decommision a device, Alice should first freeze it as above, issuing a final revocation
  statement for the key into her sigchain. Her client should
  then iterate over all TLFs that she has read or write access to, and delete the lost
  keys from the keyblocks, and then rekey.  She of course needs an active keypair in order to do this.
  Let's say \(r\) is Alice's lost device, and \(d\) is her currently
  active device.  Also, Alice can optionally provision a new device \(n\) as a result
  of this process:
  </p>

  <ol>
    <li>For each TLF \(f\) Alice can write to:
    <ol>
      <li>Generate an ephemeral Curve25519 Diffie-Helman keypair.  Call it \((M_e,m_e)\). </li>
      <li>Delete \(S^{f,0,r}_{A}\)</li>
      <li>Ask the server to delete \(s^{f,0,r}_A\).</li>
      <li>Generate a new 32-byte random secret key (version=1 for the next one): \(s^{f,1}\) = rand(32)</li>
      <li>For each user \(u\) who can access \(f\)
      <ol>
        <li>For each device \(i\) that \(u\) has:
          <ol>
            <li>As before, generate \(s^{f,1,i}_{u} = \) rand(32), for the server-side of the key</li>
            <li>As before, encrypt:
              \(S^{f,1,i}_{u} = \)Box\((m_e, M^i_u, s^{f,1,i}_u \oplus s^{f,1})\)
            </li>
          </ol>
        </li>
      </ol>
      </li>
      <li>If provisioning \(n\), generate and encrypt \(S^{f,1,n}_{A}\).</li>
      <li>Store the rekeyed key blocks to the server, signed with \(e^d_A\)</li>
      <li>Store \(M_e\) to the server </li>
      <li>Don't bother to reencrypt old blocks, so leave the old decryption materials around
          (except for the compromised key)</li>
    </ol>
    </li>
    <li>For each TLF \(f\) Alice can read:
      <ol>
        <li>Ask the server to delete \(s^{f,0,r}_A\).</li>
        <li>Flip the <strong>rekey</strong> flag on TLF \(f\) to ``on''.  The next writer who updates the directory
            will perform the above protocol that Alice used for her writable directories.</li>
      </ol>
    </li>
    <li>Rekey any organizations that Alice is a member of (see below).</li>
  </ol>

  <h3>Eldest Key Update (or Deletion) [Unimplemented]</h3>

  <p>
    If Alice fears all of her sibling keys have been compromised, she should
    start from scratch. The protocol is:
  </p>

  <ol>
    <li>Generate a new eldest key pair.</li>
    <li>Generate a new per-device keys for the current device.</li>
    <li>Decommission all old keys, while provisioning the device keys.</li>
  </ol>

  <p>
    If simply deleting her account, Alice will do as above but will not generate
    new keys or provision new devices.
  </p>

  <h2>Organizations</h2>

  <p>
    See our discussion of <a href="/docs/teams">Teams</a>.
  </p>

  <h2>Other Topics</h2>

  <h3>File Wipe [Unimplemented]</h3>

  <p>
    The server maintains a list of which block-specific keys are in use for
    each folder.  It doesn't know which key corresponds to which files, since
    the TLF structure cannot be recreated without decryption keys.
  </p>

  <h4>With A Provisioned Device</h4>

  <p>
    Say the user wants to delete a file \(f\).
    A provisioned device can compute a set \(I\) such that for any \(i \in I\),
    \(b_i\) is or was a part of \(f\).  The client then asks
    the server to delete \(s_i\) for \(i \in I\).  The server
    honors this request as long as the user can write to the parent TLF.
  </p>

  <h4>Without a Provisioned Device</h4>

  <p>
    If a user loses all of his provisioned devices, he can ask the server to wipe
    a TLF by deleting all keys for blocks in that TLF.  The server keeps
    a list, so can perform the task.  Of course, the server will only honor
    such a request if the user can write to this TLF.
  </p>

</div>
            </section>
        </div>
    </div>
        <footer class="footer" data-footer-label="下一章">
        <a class="footer__link" href="/docs/crypto/_account-corner-cases">
            <div class="footer__inner">
            <p class="footer__title" data-chapter-count="D">Keybase Account Corner Cases (Plan)</p>
                
            </div>
            <img alt="" class="footer__image" src="/static/img/illos/docs.jpg" loading="lazy" width="870"/>
        </a>
    </footer>
    
    <script src="/static/js/Nav.js" type="module" async></script>

    
        <script src="/static/js/vendor/gsap.min.js"></script>
        <script src="/static/js/vendor/katex.min.js"></script>
        <script src="/static/js/vendor/auto-render.min.js"></script>
        <script src="/static/js/docs.js" type="module" async></script>
    
      </main>
    </div>
    <footer class="site-footer">
  <div class="site-footer__inner">
    <a class="site-footer__brand" href="/">Keybase&nbsp;<span>Book</span></a>
    <ul class="site-footer__list">
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/">Keybase Home</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://github.com/keybase/book-content/issues">Bug Reporting</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/docs/terms">Terms</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/docs/privacypolicy">Privacy</a>
      </li>
      <li class="site-footer__list-item">
        <a class="site-footer__link" href="https://keybase.io/docs/acceptable-use-policy">Acceptable Use</a>
      </li>
    </ul>
    


<template id="link-android">
    <a href="https://keybase.io/_/download/keybase-for-android" class="download__button" aria-label="Download Keybase"><img src="https://keybase.io/images/getting-started/play_store_badge_320x94.png" alt="" style="width: 120px;"></a>
    <a class="download__link" href="https://keybase.io/download">Also available for iOS, Linux, Mac OS, and Windows</a>
</template>

<template id="link-ios">
    <a href="https://keybase.io/_/download/keybase-for-ios" class="download__button" aria-label="Download Keybase">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 119.664 40">
    <path
    d="M110.135 0H9.535c-.367 0-.73 0-1.095.002-.306.002-.61.008-.919.013A13.215 13.215 0 005.517.19a6.665 6.665 0 00-1.9.627 6.438 6.438 0 00-1.62 1.18A6.258 6.258 0 00.82 3.617 6.601 6.601 0 00.195 5.52a12.993 12.993 0 00-.179 2.002c-.01.307-.01.615-.015.921V31.56c.005.31.006.61.015.921a12.992 12.992 0 00.18 2.002 6.588 6.588 0 00.624 1.905A6.208 6.208 0 001.998 38a6.274 6.274 0 001.618 1.179 6.7 6.7 0 001.901.63 13.455 13.455 0 002.004.177c.31.007.613.011.919.011.366.002.728.002 1.095.002h100.6c.36 0 .724 0 1.084-.002.304 0 .617-.004.922-.01a13.279 13.279 0 002-.178 6.804 6.804 0 001.908-.63A6.277 6.277 0 00117.666 38a6.395 6.395 0 001.182-1.614 6.604 6.604 0 00.619-1.905 13.506 13.506 0 00.185-2.002c.004-.31.004-.61.004-.921.008-.364.008-.725.008-1.094V9.536c0-.366 0-.73-.008-1.092 0-.306 0-.614-.004-.92a13.507 13.507 0 00-.185-2.003 6.618 6.618 0 00-.62-1.903 6.466 6.466 0 00-2.798-2.8 6.768 6.768 0 00-1.908-.627 13.044 13.044 0 00-2-.176c-.305-.005-.618-.011-.922-.013-.36-.002-.725-.002-1.084-.002z"
    fill="var(--color--content__text)"
    />
    <path
    d="M8.445 39.125c-.305 0-.602-.004-.904-.01a12.687 12.687 0 01-1.87-.164 5.884 5.884 0 01-1.656-.548 5.406 5.406 0 01-1.397-1.016 5.32 5.32 0 01-1.02-1.397 5.722 5.722 0 01-.544-1.657 12.414 12.414 0 01-.166-1.875c-.007-.21-.015-.913-.015-.913v-23.1s.009-.692.015-.895a12.37 12.37 0 01.165-1.872 5.755 5.755 0 01.544-1.662 5.373 5.373 0 011.015-1.398 5.565 5.565 0 011.402-1.023 5.823 5.823 0 011.653-.544A12.586 12.586 0 017.543.887l.902-.012h102.769l.913.013a12.385 12.385 0 011.858.162 5.938 5.938 0 011.671.548 5.594 5.594 0 012.415 2.42 5.763 5.763 0 01.535 1.649 12.995 12.995 0 01.174 1.887c.003.283.003.588.003.89.008.375.008.732.008 1.092v20.929c0 .363 0 .718-.008 1.075 0 .325 0 .623-.004.93a12.731 12.731 0 01-.17 1.853 5.739 5.739 0 01-.54 1.67 5.48 5.48 0 01-1.016 1.386 5.413 5.413 0 01-1.4 1.022 5.862 5.862 0 01-1.668.55 12.542 12.542 0 01-1.869.163c-.293.007-.6.011-.897.011l-1.084.002z"
    fill="var(--color--content__background)"
    />
    <path
    d="M24.997 19.89a5.146 5.146 0 012.45-4.318 5.268 5.268 0 00-4.15-2.244c-1.746-.183-3.44 1.045-4.33 1.045-.906 0-2.276-1.027-3.752-.997a5.527 5.527 0 00-4.65 2.837c-2.012 3.482-.512 8.6 1.415 11.414.963 1.378 2.09 2.918 3.564 2.863 1.442-.06 1.981-.92 3.722-.92 1.725 0 2.23.92 3.734.886 1.548-.026 2.523-1.385 3.453-2.776a11.4 11.4 0 001.58-3.216 4.973 4.973 0 01-3.036-4.575zm-2.841-8.413a5.067 5.067 0 001.16-3.63 5.155 5.155 0 00-3.336 1.726 4.821 4.821 0 00-1.19 3.495 4.263 4.263 0 003.366-1.591zM42.302 27.14h-4.734l-1.136 3.356h-2.005l4.483-12.418h2.083l4.484 12.418h-2.04zm-4.243-1.55h3.752l-1.85-5.446h-.052zm17.101.38c0 2.813-1.507 4.62-3.78 4.62a3.07 3.07 0 01-2.848-1.583h-.043v4.484h-1.858V21.442h1.799v1.506h.034a3.212 3.212 0 012.883-1.6c2.298 0 3.812 1.816 3.812 4.622zm-1.911 0c0-1.833-.947-3.038-2.393-3.038-1.42 0-2.375 1.23-2.375 3.038 0 1.824.956 3.046 2.375 3.046 1.446 0 2.393-1.197 2.393-3.046zm11.876 0c0 2.813-1.507 4.62-3.78 4.62a3.07 3.07 0 01-2.848-1.583h-.043v4.484h-1.858V21.442h1.799v1.506h.034a3.212 3.212 0 012.883-1.6c2.297 0 3.813 1.816 3.813 4.622zm-1.911 0c0-1.833-.947-3.038-2.393-3.038-1.42 0-2.375 1.23-2.375 3.038 0 1.824.955 3.046 2.375 3.046 1.446 0 2.393-1.197 2.393-3.046zm8.496 1.066c.137 1.232 1.333 2.04 2.968 2.04 1.567 0 2.694-.808 2.694-1.919 0-.964-.68-1.54-2.29-1.936l-1.609-.388c-2.28-.55-3.339-1.617-3.339-3.348 0-2.142 1.867-3.614 4.518-3.614 2.625 0 4.424 1.472 4.484 3.614H77.26c-.112-1.239-1.136-1.987-2.634-1.987s-2.521.757-2.521 1.858c0 .878.654 1.395 2.255 1.79l1.368.336c2.548.603 3.605 1.626 3.605 3.443 0 2.323-1.85 3.778-4.793 3.778-2.753 0-4.613-1.42-4.733-3.667zM83.346 19.3v2.142h1.722v1.472h-1.722v4.991c0 .776.345 1.137 1.102 1.137a5.808 5.808 0 00.611-.043v1.463a5.104 5.104 0 01-1.032.086c-1.833 0-2.548-.689-2.548-2.445v-5.189h-1.316v-1.472h1.316V19.3zm2.718 6.67c0-2.849 1.678-4.639 4.294-4.639 2.625 0 4.295 1.79 4.295 4.639 0 2.856-1.661 4.638-4.295 4.638-2.633 0-4.294-1.782-4.294-4.638zm6.695 0c0-1.954-.895-3.108-2.401-3.108s-2.401 1.162-2.401 3.108c0 1.962.895 3.106 2.4 3.106s2.402-1.144 2.402-3.106zm3.426-4.528h1.773v1.541H98a2.16 2.16 0 012.177-1.635 2.866 2.866 0 01.637.069v1.738a2.598 2.598 0 00-.835-.112 1.873 1.873 0 00-1.937 2.083v5.37h-1.858zm13.198 6.395c-.25 1.643-1.85 2.771-3.898 2.771-2.634 0-4.269-1.764-4.269-4.595 0-2.84 1.644-4.682 4.19-4.682 2.506 0 4.08 1.72 4.08 4.466v.637h-6.394v.112a2.358 2.358 0 002.436 2.564 2.048 2.048 0 002.09-1.273zm-6.282-2.702h4.526a2.177 2.177 0 00-2.22-2.298 2.292 2.292 0 00-2.306 2.298zM37.826 8.731a2.64 2.64 0 012.808 2.965c0 1.906-1.03 3.002-2.808 3.002h-2.155V8.73zm-1.228 5.123h1.125a1.876 1.876 0 001.967-2.146 1.881 1.881 0 00-1.967-2.134h-1.125zm5.082-1.41a2.133 2.133 0 114.248 0 2.134 2.134 0 11-4.247 0zm3.334 0c0-.976-.439-1.547-1.208-1.547-.773 0-1.207.571-1.207 1.547 0 .984.434 1.55 1.207 1.55.77 0 1.208-.57 1.208-1.55zm6.559 2.254h-.922l-.93-3.317h-.07l-.927 3.317h-.913l-1.242-4.503h.902l.806 3.436h.067l.926-3.436h.852l.926 3.436h.07l.803-3.436h.889zm2.281-4.503h.855v.715h.066a1.348 1.348 0 011.344-.802 1.465 1.465 0 011.559 1.675v2.915h-.889v-2.692c0-.724-.314-1.084-.972-1.084a1.033 1.033 0 00-1.075 1.141v2.635h-.888zm5.24-1.758h.888v6.26h-.888zm2.124 4.007a2.133 2.133 0 114.247 0 2.134 2.134 0 11-4.247 0zm3.333 0c0-.976-.439-1.547-1.208-1.547-.773 0-1.207.571-1.207 1.547 0 .984.434 1.55 1.207 1.55.77 0 1.208-.57 1.208-1.55zm1.849.98c0-.81.604-1.278 1.676-1.344l1.22-.07v-.389c0-.475-.315-.744-.922-.744-.497 0-.84.182-.939.5h-.86c.09-.773.818-1.27 1.84-1.27 1.128 0 1.765.563 1.765 1.514v3.077h-.855v-.633h-.07a1.515 1.515 0 01-1.353.707 1.36 1.36 0 01-1.501-1.348zm2.895-.384v-.377l-1.1.07c-.62.042-.9.253-.9.65 0 .405.351.64.834.64a1.062 1.062 0 001.166-.983zm2.053-.596c0-1.423.732-2.324 1.87-2.324a1.484 1.484 0 011.38.79h.067V8.437h.888v6.26h-.851v-.71h-.07a1.563 1.563 0 01-1.415.785c-1.145 0-1.869-.901-1.869-2.328zm.918 0c0 .955.45 1.53 1.203 1.53.75 0 1.212-.583 1.212-1.526 0-.938-.468-1.53-1.212-1.53-.748 0-1.203.58-1.203 1.526zm6.964 0a2.133 2.133 0 114.247 0 2.134 2.134 0 11-4.247 0zm3.333 0c0-.976-.438-1.547-1.208-1.547-.772 0-1.207.571-1.207 1.547 0 .984.435 1.55 1.207 1.55.77 0 1.208-.57 1.208-1.55zm2.107-2.249h.855v.715h.066a1.348 1.348 0 011.344-.802 1.465 1.465 0 011.559 1.675v2.915h-.889v-2.692c0-.724-.314-1.084-.972-1.084a1.033 1.033 0 00-1.075 1.141v2.635h-.889zm8.845-1.121v1.141h.976v.749h-.976v2.315c0 .472.194.679.637.679a2.967 2.967 0 00.339-.021v.74a2.916 2.916 0 01-.484.046c-.988 0-1.381-.348-1.381-1.216v-2.543h-.715v-.749h.715V9.074zm2.19-.637h.88v2.481h.07a1.386 1.386 0 011.374-.806 1.483 1.483 0 011.55 1.679v2.907h-.889V12.01c0-.72-.335-1.084-.963-1.084a1.052 1.052 0 00-1.134 1.142v2.63h-.888zm9.056 5.045a1.828 1.828 0 01-1.95 1.303 2.045 2.045 0 01-2.081-2.325 2.077 2.077 0 012.076-2.352c1.253 0 2.009.856 2.009 2.27v.31h-3.18v.05a1.19 1.19 0 001.2 1.29 1.08 1.08 0 001.07-.546zm-3.126-1.451h2.275a1.086 1.086 0 00-1.109-1.167 1.152 1.152 0 00-1.166 1.167z"
    fill="var(--color--content__text)"
    />
</svg>
    </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, Linux, Mac OS, and Windows</a>
</template>

<template id="link-linux">
    <a href="https://keybase.io/docs/the_app/install_linux" class="download__button" aria-label="Download Keybase">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 40">
    <path fill="var(--color--content__text)" d="M0 0h120v40H0z"/>
    <path fill="var(--color--content__background)" d="M1 1h118v38H1z"/>
    <path fill="var(--color--content__text)" d="M100.4 8a6 6 0 00-.5 0c-4.2.4-3.1 4.8-3.2 6.3 0 1.1-.3 2-1 3-.9 1-2.1 2.8-2.7 4.6-.3.8-.4 1.6-.3 2.5h-.1l-.7 1-.8.3c-.3.2-.6.3-.8.7l-.2.6v.5c.1.4.2.8.1 1-.2.7-.3 1.2 0 1.5 0 .3.4.5.8.6.9.2 2 .1 2.8.6 1 .5 1.9.7 2.6.5.6-.1 1-.5 1.2-1l2.3-.3c.7 0 1.6.3 2.6.2l.1.3c.4.8 1.1 1.2 1.9 1.1.8 0 1.6-.5 2.2-1.3.7-.8 1.7-1 2.4-1.5.4-.2.7-.5.7-.9s-.2-.8-.7-1.3v-.1c-.2-.2-.3-.6-.4-1 0-.4-.2-.8-.5-1l-.2-.2h-.2c.5-1.3.3-2.6-.1-3.7-.6-1.4-1.5-2.6-2.2-3.5-.8-1-1.6-2-1.6-3.4 0-2.1.3-6-3.5-6.1zm.5 3.4c.2 0 .4 0 .6.2l.5.5.1.8v-.1.1l-.1.7-.2.3h-.1l-.3-.2h-.2l.1-.2.1-.4v-.5l-.2-.3-.3-.1-.3.1-.2.3v.7l-.6-.2V13v-.8l.5-.5.6-.2zm-3 0l.5.2c.1.1.3.3.3.5l.2.6v.3l-.1.1-.4.2V13v-.3l-.2-.3h-.4l-.1.4v.6c0 .2.1.2.2.3l-.2.2c-.2 0-.3-.2-.4-.4l-.1-.6a1.8 1.8 0 01.3-1.2c.2-.2.3-.2.5-.2zm1.4 1.8c.4 0 .8 0 1.2.4l1.1.4.5.4v-.1.5c-.1.3-.5.6-1 .8l-.8.5c-.3.1-.6.3-1 .3l-.5-.1-.3-.2-.6-.5c-.4-.2-.7-.5-.7-.7-.1-.3 0-.5.2-.6l.4-.3.2-.2.9-.6h.4zm2.8 2.1a24 24 0 001.8 4.5c.2.5.8 1.6 1 3h.6c.6-1.6-.6-3.4-1.1-3.9-.2-.2-.2-.3-.1-.3.6.5 1.3 1.5 1.6 2.7.1.6.2 1.1 0 1.7h.2c1 .6 1.5 1 1.3 1.6h-.2c.1-.5-.2-.9-1-1.3-1-.4-1.7-.3-1.9.5v.1l-.2.1c-.4.3-.7.7-.8 1.2l-.2 1.9-.3 1.3c-1.5 1-3.6 1.5-5.4.3l-.4-.5-.2-.3h.4l.3-.4c.2-.3 0-.7-.3-1.2s-1-1-1.8-1.5c-.6-.4-1-.9-1.1-1.4-.2-.5-.2-1 0-1.6.2-1.1.8-2.2 1.2-2.8l-.4 1c-.4.7-1.1 2.5-.1 3.8 0-1 .2-2 .6-2.9.6-1.2 1.8-3.5 1.9-5.2l.3.2.6.4c.2.2.4.4.8.4h.1c.5 0 .8-.2 1-.3l.8-.4a2 2 0 001-.7zm2.2 9c0 .6.4 1.2.9 1.3.6.2 1.4-.3 1.8-.7h.2c.3 0 .6 0 .8.2.3.2.4.6.4 1l.4 1c.5.5.7.9.7 1.1 0 .3-.2.4-.5.6-.6.4-1.8.7-2.5 1.6-.6.7-1.3 1.1-2 1.2-.7 0-1.2-.2-1.6-1-.2-.3-.1-1 0-1.6.2-.7.5-1.4.5-2l.2-1.7c.1-.5.3-.8.7-1zm-10.8 0h.2c.3 0 .7.4 1 .8l.9 1.6c.2.6.8 1.1 1.2 1.7.4.6.8 1.1.7 1.6 0 .7-.5 1.1-1.1 1.3-.7.1-1.5 0-2.4-.5-1-.5-2.1-.5-2.9-.6-.3 0-.6-.2-.7-.4l.1-1.2c.2-.4 0-.8 0-1.2v-.9c.2-.3.5-.4.7-.5.3-.2.7-.2 1-.5l.6-.8c.2-.2.4-.4.7-.4zm7.2-9c-.5.1-1 .5-1.5.5-.6 0-1-.3-1.3-.5l-.4-.3c-.1-.2-.1-.4 0-.4l.1.2.4.4c.3.2.7.4 1.2.4s1-.2 1.4-.4l.6-.5.3-.3-.2.4-.6.4zm-1.1-1.6v-.1h.3l.1.1-.1.1h-.2l-.1-.1zm-.6 0H99l-.2.1h-.1l.1-.2h.3zM18.1 14v-.9h-3.6v1.3h1.9v.1c0 1-.9 1.8-2 1.8-1.4 0-2.3-1.1-2.3-3 0-1.8.8-2.8 2.2-2.8 1 0 1.7.5 2 1.4H18c-.2-1.7-1.7-2.9-3.7-2.9-2.5 0-4 1.6-4 4.3 0 2.8 1.5 4.4 4 4.4 2.4 0 3.8-1.3 3.8-3.6zM22 12.5c.7 0 1.2.5 1.3 1.3h-2.7c0-.8.6-1.3 1.3-1.3zm1.3 3.2c-.2.5-.6.8-1.3.8-.8 0-1.4-.6-1.4-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3 3.2 1.6 0 2.8-.8 3-2h-1.6zM26.3 9.9v1.4h-1v1.3h1V16c0 1.2.5 1.7 2 1.7h.8v-1.3h-.4c-.5 0-.7-.2-.7-.7v-3H29v-1.3H28V10h-1.7zM34.4 17.6V15l.7-1 2.6 3.6h2l-3.3-4.7 3.2-3.8h-2L34.4 13V9.1h-1.8v8.5h1.8zM42.8 12.5c.7 0 1.3.5 1.3 1.3h-2.7c0-.8.6-1.3 1.4-1.3zm1.3 3.2c-.1.5-.6.8-1.2.8-1 0-1.5-.6-1.5-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3.1 3.2 1.6 0 2.7-.8 2.9-2h-1.6zM47.3 20c1.6 0 2.4-.6 3-2.3l2.1-6.4h-1.8l-1.3 5-1.4-5h-1.8l2.1 6.3v.3c-.1.5-.4.7-1 .7h-.5v1.3h.6zM56.8 17.7c1.6 0 2.5-1.2 2.5-3.2s-1-3.3-2.5-3.3a2 2 0 00-2 1.2V9.1h-1.7v8.5h1.7v-1a2 2 0 002 1.1zm-.6-5.1c.9 0 1.4.7 1.4 1.9 0 1.1-.5 1.8-1.4 1.8-.8 0-1.4-.7-1.4-1.8 0-1.2.6-2 1.4-2zM62.7 16.5c-.6 0-1-.3-1-.8 0-.4.4-.7 1-.8H64v.4c0 .7-.6 1.2-1.3 1.2zm-.6 1.2c.8 0 1.6-.4 2-1v.9h1.6v-4.3c0-1.3-1-2.1-2.7-2.1-1.6 0-2.7.8-2.7 2h1.5c.1-.4.5-.7 1.2-.7.6 0 1 .3 1 .9v.4l-1.6.1c-1.5 0-2.4.8-2.4 1.9 0 1.1 1 1.9 2.1 1.9zM66.7 13.2c0 1 .6 1.5 1.8 1.8l1.1.2c.6.1.8.3.8.7 0 .4-.4.6-1 .6-.7 0-1-.3-1.2-.8h-1.7c.2 1.2 1.2 2 2.9 2 1.6 0 2.7-.8 2.7-2 0-1-.5-1.4-1.8-1.7l-1-.3c-.7 0-1-.3-1-.6 0-.4.4-.7 1-.7.7 0 1 .3 1.1.8H72c0-1.2-1-2-2.7-2-1.6 0-2.6.8-2.6 2zM75.8 12.5c.8 0 1.3.5 1.3 1.3h-2.6c0-.8.6-1.3 1.3-1.3zm1.3 3.2c-.1.5-.6.8-1.2.8-.9 0-1.5-.6-1.5-1.5v-.1h4.4v-.6c0-1.9-1.2-3.1-3-3.1-1.9 0-3 1.3-3 3.3 0 2 1.1 3.2 3 3.2 1.6 0 2.7-.8 3-2H77zM10.9 31.6h1.7v-5h1.2v-1.3h-1.3V25c0-.4.3-.7.8-.7h.5v-1a5 5 0 00-.9-.1c-1.5 0-2 .5-2 1.8v.4H10v1.3h.9v5zM17.4 31.7c1.9 0 3-1.2 3-3.2s-1.1-3.3-3-3.3-3.1 1.2-3.1 3.3c0 2 1.2 3.2 3 3.2zm0-1.3c-.9 0-1.4-.7-1.4-2 0-1.2.6-2 1.4-2 .8 0 1.4.8 1.4 2 0 1.3-.6 2-1.4 2zM21.4 31.6H23v-3.5c0-.9.5-1.4 1.3-1.4h.6v-1.4h-.4c-.8 0-1.3.4-1.5 1.2v-1.2h-1.7v6.3zM33.7 30.1H30v-7h-1.7v8.5h5.4v-1.5zM34.7 31.6h1.7v-6.3h-1.7v6.3zm.8-7.1c.5 0 1-.4 1-1 0-.4-.5-.8-1-.8a.9.9 0 100 1.8zM37.5 31.6h1.7V28c0-.8.5-1.4 1.3-1.4s1.1.5 1.1 1.3v3.7h1.8v-4c0-1.5-.8-2.4-2.2-2.4-1 0-1.7.5-2 1.2v-1h-1.7v6.2zM50.2 25.3h-1.7V29c0 .9-.4 1.4-1.2 1.4-.8 0-1.2-.5-1.2-1.3v-3.7h-1.7v4c0 1.5 1 2.4 2.3 2.4 1 0 1.5-.4 1.9-1.2v1.1h1.6v-6.3zM54 29.4l1.1 2.2H57l-2-3.2 2-3h-1.9l-1 2H54l-1.1-2h-2l2 3-2 3.2h1.8l1.2-2.2z"/>
</svg>
        </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, iOS, Mac OS, and Windows</a>
</template>

<template id="link-mac">
    <a href="https://keybase.io/docs/the_app/install_macos" class="download__button" aria-label="Download Keybase">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 120 40">
  <path fill="var(--color--content__text)" d="M0 0h120v40H0z"/>
  <path fill="var(--color--content__background)" d="M1 1h118v38H1z"/>
  <path fill="var(--color--content__text)" d="M15.2617 13.4492v-.9551h-3.5625v1.2891h1.8399l-.0059.1348c-.0352 1.0488-.8379 1.7578-1.9922 1.7578-1.4062 0-2.29686-1.1192-2.29686-2.9531 0-1.7989.83786-2.85942 2.23246-2.85942.955 0 1.6757.52732 1.9336 1.41212h1.7753c-.2519-1.71095-1.7402-2.87696-3.7148-2.87696-2.48437 0-4.03125 1.64066-4.03125 4.34766 0 2.748 1.54688 4.4004 4.07225 4.4004 2.3555 0 3.75-1.3945 3.75-3.6973zM19.1055 11.8496c.7617 0 1.2832.5508 1.3183 1.3535h-2.666c.0586-.7851.5977-1.3535 1.3477-1.3535zm1.3418 3.2285c-.1582.4805-.6387.791-1.2657.791-.873 0-1.4414-.6152-1.4414-1.5117v-.1054h4.3301v-.5215c0-1.9102-1.1543-3.1465-2.9824-3.1465-1.8574 0-3.0293 1.3008-3.0293 3.3047 0 2.0097 1.1602 3.2461 3.0937 3.2461 1.5528 0 2.6778-.8262 2.8653-2.0567h-1.5703zM23.4121 9.27148v1.44732h-.8848v1.289h.8848v3.2988c0 1.2246.5742 1.7168 2.0508 1.7168.3457 0 .6387-.0293.8144-.0703v-1.2597c-.1054.0175-.2636.0293-.416.0293-.5039 0-.7383-.2286-.7383-.709v-3.0059h1.1602v-1.289H25.123V9.27148h-1.7109zM31.5156 17v-2.584l.791-.9492L34.8145 17h2.1152l-3.3457-4.7051 3.1289-3.74998h-1.9688l-3.1757 3.85548h-.0528V8.54492h-1.7695V17h1.7695zM39.9414 11.8496c.7617 0 1.2832.5508 1.3184 1.3535h-2.666c.0585-.7851.5976-1.3535 1.3476-1.3535zm1.3418 3.2285c-.1582.4805-.6387.791-1.2656.791-.8731 0-1.4414-.6152-1.4414-1.5117v-.1054h4.33v-.5215c0-1.9102-1.1542-3.1465-2.9824-3.1465-1.8574 0-3.0293 1.3008-3.0293 3.3047 0 2.0097 1.1602 3.2461 3.0938 3.2461 1.5527 0 2.6777-.8262 2.8652-2.0567h-1.5703zM44.5059 19.3262c1.5996 0 2.3906-.5742 2.9238-2.1856l2.1621-6.4218h-1.8047l-1.3301 4.9101h-.0351l-1.336-4.9101h-1.875l2.1856 6.2871c.0058.0234-.0586.2753-.0586.2988-.1172.498-.4277.6973-1.0488.6973-.0645 0-.375 0-.4336-.0118v1.3184c.0586.0117.5859.0176.6504.0176zM53.957 17.0996c1.5821 0 2.5489-1.2187 2.5489-3.2402 0-2.0274-.9727-3.2403-2.5547-3.2403-.8965 0-1.5938.4454-1.9395 1.1895h-.0351V8.54492h-1.711V17h1.6875v-1.0781h.0352c.3457.7324 1.0488 1.1777 1.9687 1.1777zm-.5918-5.1094c.8496 0 1.3887.7266 1.3887 1.8692 0 1.1484-.5332 1.8633-1.3887 1.8633-.832 0-1.3945-.7266-1.3945-1.8633 0-1.125.5684-1.8692 1.3945-1.8692zM59.8223 15.8633c-.5801 0-.9668-.293-.9668-.7617 0-.4454.3633-.7325 1.0019-.7793l1.3242-.0821v.4571c0 .6797-.6152 1.166-1.3593 1.166zm-.5625 1.2363c.7851 0 1.5644-.3926 1.916-1.0605h.0351V17h1.6524v-4.3184c0-1.2656-1.0488-2.0976-2.6602-2.0976-1.664 0-2.7011.8379-2.7656 2.0566h1.5645c.082-.4629.4863-.7793 1.125-.7793.6445 0 1.0546.3399 1.0546.9258v.416l-1.582.0938c-1.5644.0937-2.4434.7558-2.4434 1.8984 0 1.1309.9083 1.9043 2.1036 1.9043zM63.8652 12.5645c0 .9433.6153 1.5527 1.8282 1.8105l1.0722.2227c.6153.1406.8321.3281.8321.6621 0 .4101-.3985.6738-1.043.6738-.6797 0-1.0723-.293-1.1777-.8438h-1.67c.1114 1.2364 1.1133 2.045 2.8477 2.045 1.6172 0 2.748-.8145 2.748-2.0508 0-.9199-.539-1.4356-1.8515-1.711l-1.0723-.2285c-.6328-.1347-.8672-.3515-.8672-.6738 0-.416.3926-.6855.9844-.6855.6328 0 1.0137.3457 1.0664.8554h1.5762c-.0352-1.2304-1.0313-2.0566-2.6426-2.0566-1.5996 0-2.6309.7851-2.6309 1.9805zM72.9648 11.8496c.7618 0 1.2832.5508 1.3184 1.3535h-2.666c.0586-.7851.5976-1.3535 1.3476-1.3535zm1.3418 3.2285c-.1582.4805-.6386.791-1.2656.791-.873 0-1.4414-.6152-1.4414-1.5117v-.1054h4.3301v-.5215c0-1.9102-1.1543-3.1465-2.9824-3.1465-1.8575 0-3.0293 1.3008-3.0293 3.3047 0 2.0097 1.1601 3.2461 3.0937 3.2461 1.5528 0 2.6778-.8262 2.8653-2.0567h-1.5704zM8.01367 31h1.71094v-4.9922h1.20699V24.748H9.68359v-.416c0-.4453.2461-.6914.80861-.6914.1699 0 .3398.0117.4629.0352v-1.1309c-.1992-.041-.5567-.0761-.8731-.0761-1.48825 0-2.06833.5742-2.06833 1.8046v.4746H7.1582v1.2598h.85547V31zM14.541 31.1348c1.8985 0 3.1113-1.2129 3.1113-3.2813 0-2.039-1.2304-3.2695-3.1113-3.2695-1.8808 0-3.1113 1.2363-3.1113 3.2695 0 2.0625 1.2129 3.2813 3.1113 3.2813zm0-1.3067c-.8437 0-1.3769-.709-1.3769-1.9687 0-1.2481.5449-1.9688 1.3769-1.9688s1.3711.7207 1.3711 1.9688c0 1.2597-.5332 1.9687-1.3711 1.9687zM18.5371 31h1.7109v-3.5098c0-.8847.4922-1.4004 1.336-1.4004.2461 0 .4805.0411.6211.0997v-1.5059c-.1172-.0352-.2871-.0645-.4863-.0645-.7383 0-1.2715.4336-1.4942 1.2305h-.0351v-1.1308h-1.6524V31zM25.2871 31h1.7109v-3.791c0-.7031.4395-1.1953 1.0899-1.1953.6328 0 1.0137.3984 1.0137 1.0722V31h1.6464v-3.8145c0-.6972.4278-1.1718 1.0782-1.1718.6621 0 1.0254.3984 1.0254 1.125V31h1.7109v-4.2891c0-1.2656-.8262-2.1093-2.0566-2.1093-.92 0-1.67.498-1.9512 1.289h-.0352c-.2109-.8203-.8437-1.289-1.7519-1.289-.8555 0-1.5293.498-1.793 1.2539h-.0351v-1.1367h-1.6524V31zM38.0723 29.8633c-.5801 0-.9668-.293-.9668-.7617 0-.4454.3633-.7325 1.0019-.7793l1.3242-.0821v.4571c0 .6797-.6152 1.166-1.3593 1.166zm-.5625 1.2363c.7851 0 1.5644-.3926 1.916-1.0605h.0351V31h1.6524v-4.3184c0-1.2656-1.0488-2.0976-2.6602-2.0976-1.664 0-2.7011.8379-2.7656 2.0566h1.5645c.082-.4629.4863-.7793 1.125-.7793.6445 0 1.0546.3399 1.0546.9258v.416l-1.582.0938c-1.5644.0937-2.4434.7558-2.4434 1.8984 0 1.1309.9083 1.9043 2.1036 1.9043zM47.9277 27.0566c-.0761-1.4238-1.1543-2.4726-2.8535-2.4726-1.8808 0-3.082 1.2539-3.082 3.2695 0 2.0508 1.2012 3.2813 3.0937 3.2813 1.6524 0 2.7598-.9551 2.8477-2.4375h-1.5938c-.1054.6855-.5507 1.0957-1.2363 1.0957-.8496 0-1.3769-.7032-1.3769-1.9395 0-1.2129.5273-1.9277 1.3711-1.9277.7031 0 1.1425.4687 1.2421 1.1308h1.5879zM52.7207 22.3984c-2.5078 0-4.0781 1.6817-4.0781 4.377 0 2.6894 1.5703 4.3711 4.0781 4.3711 2.502 0 4.0781-1.6817 4.0781-4.3711 0-2.6953-1.5761-4.377-4.0781-4.377zm0 1.4766c1.3828 0 2.2676 1.125 2.2676 2.9004 0 1.7695-.8848 2.8887-2.2676 2.8887-1.3887 0-2.2734-1.1192-2.2734-2.8887 0-1.7754.8906-2.9004 2.2734-2.9004zM57.6191 28.5859c.0528 1.5938 1.3946 2.5606 3.4102 2.5606 2.1152 0 3.4102-1.0488 3.4102-2.7012 0-1.2832-.7793-2.0039-2.5665-2.3613l-.8964-.1817c-.9961-.1992-1.4063-.5214-1.4063-1.0429 0-.6211.5859-1.0313 1.459-1.0313.8906 0 1.5176.4336 1.5762 1.1543h1.6699c-.0293-1.5527-1.2715-2.584-3.2461-2.584-1.8809 0-3.2285 1.0254-3.2285 2.5723 0 1.2598.8262 2.0684 2.5137 2.4023l.8906.1758c1.0605.2168 1.459.5332 1.459 1.0899 0 .6211-.6446 1.0781-1.5879 1.0781-.961 0-1.6758-.4219-1.7871-1.1309h-1.67zM94.7091 29.5758c-.4611-.2895-.8705-.644-1.2126-1.0535-.3734-.4242-.7194-.8703-1.0372-1.3321-.7466-1.026-1.3305-2.1483-1.7351-3.331C90.2369 22.4831 90 21.1657 90 19.8767c0-1.4383.3314-2.6934.9767-3.7469.4776-.8246 1.1892-1.5144 2.047-1.999.8285-.4856 1.7936-.7513 2.7683-.7696.3412 0 .7116.0458 1.1015.1374.2827.0733.6238.1924 1.043.339.5361.1924.8285.3115.926.339.3119.1099.5751.1557.7798.1557.156 0 .3797-.0458.6287-.1191.141-.0458.409-.1282.79-.284.376-.1283.674-.2382.911-.3206.361-.1008.71-.1924 1.023-.2382.381-.055.758-.0733 1.12-.0458.692.0458 1.325.1832 1.891.3847.994.3757 1.796.962 2.395 1.7957-.254.1465-.488.3169-.707.5038-.475.394-.877.8612-1.199 1.3788-.419.7054-.634 1.5025-.628 2.3087.015.9921.283 1.8643.819 2.6201.377.5497.881 1.0206 1.495 1.4072.302.1924.568.3252.819.4122-.117.3436-.246.678-.395 1.0078-.338.7393-.741 1.4475-1.218 2.1162-.421.5772-.753 1.0078-1.004 1.2918-.392.4397-.77.7695-1.15 1.005-.42.2611-.912.3994-1.416.3994-.341.0138-.682-.0275-1.008-.1163-.282-.0871-.561-.1851-.834-.2959-.286-.1228-.581-.2272-.882-.3115-.371-.0916-.751-.1356-1.1349-.1347-.3899 0-.77.0458-1.1307.1328-.3022.0807-.5946.1796-.8841.2978-.4094.1603-.6774.2657-.8334.3115-.3158.0879-.6395.1411-.965.1603-.5069 0-.9787-.1374-1.4485-.4123l.0127-.0119zM101.39 12.664c-.663.3115-1.292.4434-1.9231.3995-.0975-.5919 0-1.2002.2631-1.8662.234-.568.546-1.081.975-1.5391.448-.47639.984-.87033 1.589-1.15433.643-.31148 1.257-.47639 1.842-.50387.078.62297 0 1.23678-.244 1.89639-.222.58631-.553 1.12681-.974 1.61241-.425.4764-.951.8703-1.546 1.1543l.018.0009z"/>
</svg>
        </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, iOS, Linux, and Windows</a>
</template>

<template id="link-windows">
    <a href="https://keybase.io/docs/the_app/install_windows" class="download__button" aria-label="Download Keybase">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 40">
    <path fill="var(--color--content__text)" d="M0 0h120v40H0z"/>
    <path fill="var(--color--content__background)" d="M1 1h118v38H1z"/>
    <path fill="var(--color--content__text)" d="M17.3 13.4v-1h-3.6v1.4h1.8v.1c0 1-.8 1.8-2 1.8-1.4 0-2.3-1.1-2.3-3 0-1.8.9-2.8 2.3-2.8 1 0 1.7.5 2 1.4h1.7c-.3-1.7-1.8-2.9-3.7-2.9-2.5 0-4 1.6-4 4.3 0 2.8 1.5 4.4 4 4.4 2.4 0 3.8-1.3 3.8-3.7zM21.1 11.8c.8 0 1.3.6 1.3 1.4h-2.6c0-.8.6-1.4 1.3-1.4zm1.3 3.3c-.1.5-.6.8-1.2.8-.9 0-1.5-.6-1.5-1.5v-.1h4.4v-.6c0-1.9-1.2-3.1-3-3.1-1.9 0-3 1.3-3 3.3 0 2 1.1 3.2 3 3.2 1.6 0 2.7-.8 3-2h-1.7zM25.4 9.3v1.4h-.9V12h1v3.3c0 1.2.5 1.7 2 1.7h.8v-1.3h-.4c-.5 0-.8-.2-.8-.7v-3h1.2v-1.3H27V9.3h-1.7zM33.5 17v-2.6l.8-1 2.5 3.6H39l-3.3-4.7 3.1-3.8h-2l-3.1 3.9V8.5h-1.9V17h1.8z"/>
    <path fill="var(--color--content__text)" d="M42 11.8c.7 0 1.2.6 1.3 1.4h-2.7c0-.8.6-1.4 1.3-1.4zm1.3 3.3c-.2.5-.7.8-1.3.8-.9 0-1.4-.6-1.4-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3 3.2 1.6 0 2.8-.8 3-2h-1.6zM46.5 19.3c1.6 0 2.4-.5 3-2.2l2-6.4h-1.7l-1.3 5-1.4-5h-1.9l2.2 6.3v.3c-.2.5-.5.7-1.1.7h-.4v1.3h.6zM56 17.1c1.5 0 2.5-1.2 2.5-3.2s-1-3.3-2.5-3.3a2 2 0 00-2 1.2V8.5h-1.7V17H54v-1a2 2 0 002 1.1zm-.6-5.1c.8 0 1.4.7 1.4 1.9 0 1.1-.6 1.8-1.4 1.8-.9 0-1.4-.7-1.4-1.8 0-1.2.5-2 1.4-2zM61.8 15.9c-.6 0-1-.3-1-.8 0-.4.4-.7 1-.8h1.4v.4c0 .7-.6 1.2-1.4 1.2zm-.5 1.2c.7 0 1.5-.4 1.9-1v.9H65v-4.3c0-1.3-1-2.1-2.7-2.1-1.7 0-2.7.8-2.8 2H61c0-.4.5-.7 1.1-.7.7 0 1 .3 1 .9v.4l-1.5.1c-1.6 0-2.4.8-2.4 1.9 0 1.1.9 1.9 2 1.9zM65.9 12.6c0 1 .6 1.5 1.8 1.8l1 .2c.7.1.9.3.9.7 0 .4-.4.6-1 .6-.7 0-1.1-.3-1.2-.8h-1.7c.1 1.2 1.1 2 2.9 2 1.6 0 2.7-.8 2.7-2 0-1-.5-1.5-1.8-1.7l-1.1-.3c-.7 0-.9-.3-.9-.6 0-.4.4-.7 1-.7s1 .3 1 .8h1.6c0-1.2-1-2-2.6-2s-2.6.8-2.6 2zM75 11.8c.7 0 1.2.6 1.3 1.4h-2.7c0-.8.6-1.4 1.4-1.4zm1.3 3.3c-.2.5-.6.8-1.3.8-.8 0-1.4-.6-1.4-1.5v-.1h4.3v-.6c0-1.9-1.1-3.1-3-3.1-1.8 0-3 1.3-3 3.3 0 2 1.2 3.2 3.1 3.2 1.6 0 2.7-.8 2.9-2h-1.6zM10 31h1.7v-5H13v-1.3h-1.2v-.4c0-.4.2-.7.8-.7h.5v-1a5 5 0 00-1-.1c-1.4 0-2 .5-2 1.8v.4h-.8V26h.8v5zM16.5 31.1c2 0 3.2-1.2 3.2-3.2s-1.3-3.3-3.2-3.3c-1.8 0-3 1.2-3 3.3 0 2 1.1 3.2 3 3.2zm0-1.3c-.8 0-1.3-.7-1.3-2 0-1.2.5-2 1.3-2 .9 0 1.4.8 1.4 2 0 1.3-.5 2-1.4 2zM20.5 31h1.7v-3.5c0-.9.5-1.4 1.4-1.4h.6v-1.4h-.5c-.7 0-1.3.4-1.5 1.1v-1h-1.7V31zM32.5 25.2l1.7 5.8h1.6l2.3-8.5h-1.9L35 28.7l-1.6-6.2h-1.5l-1.6 6.2-1.4-6.2H27l2.2 8.5H31l1.6-5.8zM39 31h1.6v-6.3H39V31zm.8-7.1c.5 0 .8-.4.8-1 0-.4-.3-.8-.8-.8a.9.9 0 100 1.8zM41.8 31h1.7v-3.6c0-.8.5-1.4 1.2-1.4.8 0 1.2.5 1.2 1.3V31h1.7v-4c0-1.5-.8-2.4-2.2-2.4-1 0-1.6.5-2 1.2v-1h-1.6V31zM51 31.1a2 2 0 002-1.2V31h1.7v-8.5H53v3.3a2 2 0 00-2-1.2c-1.6 0-2.6 1.3-2.6 3.2 0 2 1 3.3 2.6 3.3zm.6-5.1c.8 0 1.4.7 1.4 1.9 0 1.1-.6 1.8-1.4 1.8-.9 0-1.4-.7-1.4-1.8 0-1.2.5-2 1.4-2zM58.7 31.1c1.9 0 3.1-1.2 3.1-3.2s-1.2-3.3-3-3.3c-2 0-3.2 1.2-3.2 3.3 0 2 1.2 3.2 3.1 3.2zm0-1.3c-.8 0-1.4-.7-1.4-2 0-1.2.6-2 1.4-2 .8 0 1.4.8 1.4 2 0 1.3-.6 2-1.4 2zM71.5 24.7h-1.7l-1 4.7-1.1-4.7H66L65 29.4l-1-4.7h-1.7l1.7 6.3h1.8l1.1-4.4L68 31h1.8l1.7-6.3zM72 26.6c0 1 .6 1.5 1.8 1.8l1 .2c.7.1 1 .3 1 .7 0 .4-.5.6-1.1.6-.7 0-1.1-.3-1.2-.8h-1.7c.1 1.2 1.1 2 2.9 2 1.6 0 2.7-.8 2.7-2 0-1-.5-1.5-1.8-1.7l-1.1-.3c-.6 0-.9-.3-.9-.6 0-.4.4-.7 1-.7s1 .3 1 .8h1.7c0-1.2-1-2-2.7-2-1.6 0-2.6.8-2.6 2zM88 12.2l9-1.3v8.7h-9v-7.4zm10-1.4L110 9v10.4H98v-8.6zm-10 9.8h9v8.6L88 28v-7.4zm10 0h12V31l-11.8-1.7"/>
</svg>
        </a>
    <a class="download__link" href="https://keybase.io/download">Also available for Android, iOS, Linux, and Mac OS</a>
</template>


<template id="link-unknown">
  <a href="https://keybase.io/download" class="download__button" aria-label="Download Keybase">
  <svg viewBox="0 0 118 38" xmlns="http://www.w3.org/2000/svg">
    <rect stroke="var(--color--content__text)" fill="none"  x=".5" y=".5" width="117" height="37" rx="4.5"/>
    <path fill="var(--color-content__text)" d="M27.7 25.6a1 1 0 00-.9.6 1 1 0 00.7 1.3 1 1 0 001-.4 1 1 0 00-.8-1.5zm5.7-7.6a11 11 0 00-5.4-4.2 4 4 0 00-2.4-5.3 5 5 0 00-1.7-.3c0-.1-.1-.6.5-1.8l-1.2-.7-.3.3-1.2 1.8h-.5l-2-.1c-2.7 0-2.7 2.7-2.7 2.3v2c-.2 1.3 1 2.5 2.4 2.6h.4a11 11 0 00-2.4 1.9c-3.2 3.2-3.2 6.8-3.2 9.7v1.7l1.2-1.5c.2.7.4 1.3.8 2 .3.5.7.4 1 .3.2 0 .5-.3.2-1-.4-.9-.7-1.8-.8-2.8l2.4-3-1.3 3.8c3-2.2 8-3.2 12.1-2 1.8.5 3.5 0 4.4-1.2v-.2c.2.5.2 1 .2 1.5a12 12 0 01-.8 4.2c0 .3.1.7.5.8.4 0 .8-.2 1-.6.4-1.3.7-2.8.7-4.4 0-2-.7-4-1.9-5.8zm-13-7.4h-.9v1.1h.6v1H19a.6.6 0 01-.6-.7v-1.9c.1-.6.8-.5.8-.5h1.5l-.4 1zm7.5 9a.5.5 0 01-.7-.1l-.5-.6-1.8 1.4a.4.4 0 01-.5 0l-.9-1a.4.4 0 01.1-.6l1.8-1.4-.7-.9-1 .7a.4.4 0 01-.5 0l-.2-.2a.4.4 0 01.1-.6l.9-.7-1-1.1a.5.5 0 01.1-.7.5.5 0 01.8 0l4.1 5a.5.5 0 010 .7zm-5.3 6a1 1 0 00-.8.6 1 1 0 00.6 1.3 1 1 0 001-.4 1 1 0 00-.8-1.5z"/>
    <path fill="var(--color-content__text)" d="M49.7 15V8.3h2.4c.5 0 1 .1 1.4.3a3.1 3.1 0 011.8 1.7 3.5 3.5 0 010 2.7 3 3 0 01-1.8 1.8l-1.4.2h-2.4zm2.4-.9c.4 0 .8 0 1-.2.4-.1.6-.3.8-.5l.5-.8.1-1-.1-.9a2.2 2.2 0 00-1.2-1.3l-1-.2h-1.5v5h1.4zm6.8 1c-.4 0-.7 0-1-.2l-.8-.5-.5-.8a2.8 2.8 0 01.5-2.8A2.3 2.3 0 0159 10c.4 0 .7.1 1 .3.3 0 .6.3.8.5l.5.8.2 1-.2 1-.5.8-.8.5c-.3.2-.6.2-1 .2zm0-.8l.7-.1.4-.4.3-.6a2.2 2.2 0 000-1.3c0-.2-.2-.4-.3-.5a1.4 1.4 0 00-1-.6l-.7.2c-.2 0-.4.2-.5.4l-.3.5v1.4c0 .2.2.3.3.5a1.4 1.4 0 001.1.5zm7.8.7l-1.2-3.7-1.2 3.7h-1L62 10.2h.9l1 3.7 1.3-3.7h.8l1.2 3.7 1-3.7h1L67.6 15h-1zm6.5 0v-3c0-.5-.1-.8-.3-1l-.7-.2c-.3 0-.6.1-.8.3l-.6.5V15H70v-4.8h1v.7a2 2 0 01.6-.6 2.2 2.2 0 011-.3c.6 0 1 .2 1.2.4.3.3.4.7.4 1.2V15h-1zm2.3 0V8.3h1V15h-1zm4.5.1c-.4 0-.7 0-1-.2l-.8-.5-.5-.8a2.8 2.8 0 01.5-2.8A2.3 2.3 0 0180 10c.4 0 .7.1 1 .3.3 0 .6.3.8.5l.5.8.1 1-.1 1-.5.8-.8.5c-.3.2-.6.2-1 .2zm0-.8l.6-.1.5-.4.3-.6a2.2 2.2 0 000-1.3c0-.2-.2-.4-.3-.5a1.4 1.4 0 00-1.1-.6l-.6.2c-.2 0-.4.2-.5.4l-.3.5-.1.7v.7l.4.5a1.4 1.4 0 001 .5zm6.6.7v-.5a2 2 0 01-.7.5l-1 .1h-.5l-.6-.4a1.5 1.5 0 01-.5-1.2l.1-.7.4-.5.6-.3h.6l.9.1.7.5v-.8c0-.3-.2-.6-.4-.7-.2-.2-.5-.3-.8-.3a2 2 0 00-1.5.7l-.4-.7c.6-.5 1.2-.8 2-.8l.8.1a1.6 1.6 0 011 .9l.2.7V15h-1zm-1.3-.5c.3 0 .5 0 .7-.2.2 0 .4-.2.6-.4v-.8l-.6-.4-.7-.1c-.3 0-.6 0-.8.2-.2.2-.3.4-.3.7 0 .3.1.6.3.7.2.2.5.3.8.3zm7 .5v-.7c-.1.3-.4.4-.7.6l-.8.2c-.4 0-.6 0-1-.2a2 2 0 01-.6-.5l-.4-.8-.2-1c0-.4 0-.7.2-1 0-.4.2-.6.4-.9a2 2 0 011.6-.6c.3 0 .6 0 .8.2.3.1.5.3.7.6V8.3h1V15h-1zm-1.3-.7c.3 0 .5 0 .8-.2l.5-.5v-2c0-.2-.3-.4-.5-.5a1.5 1.5 0 00-1.4-.1c-.2 0-.3.2-.5.3l-.3.6v1.4l.3.5a1.3 1.3 0 001.1.5zM55.5 29l-2.9-3.7-.7.8V29h-2v-9.3h2v4.1l3.3-4.1h2.5L54 24l4 5h-2.5zm6 .2c-.4 0-1-.1-1.4-.3l-1.1-.7a3.4 3.4 0 01-1-2.6c0-.5 0-1 .2-1.4a3.5 3.5 0 011.9-1.8 3.5 3.5 0 012.7 0c.5.1.8.4 1.1.7.3.3.5.7.7 1.2.2.4.3 1 .3 1.5v.4h-5c0 .4.2.8.5 1 .3.4.8.6 1.4.6a2.8 2.8 0 001.8-.7l.8 1.1c-.4.3-.8.6-1.3.7a5 5 0 01-1.5.3zm1.6-4.2v-.5l-.4-.5-.5-.4-.7-.1-.8.1-.5.4-.3.5-.1.5h3.3zm3 5l.3.1H67.3l.4-.4.2-.6-2.7-6.9H67l1.7 4.7 1.8-4.7h2l-3.3 8c-.2.5-.6 1-1 1.2a3.4 3.4 0 01-2 .3H66l.3-1.6zm9-3.2l.7.6.8.2c.5 0 1-.2 1.3-.5.3-.4.4-.9.4-1.5s-.1-1-.4-1.4c-.3-.4-.8-.5-1.3-.5-.3 0-.6 0-.8.2-.3.1-.6.3-.7.5v2.4zM73.3 29v-9.3h1.8V23a2.6 2.6 0 012-1 2.8 2.8 0 012.2 1c.3.2.5.6.7 1l.2 1.5c0 .6-.1 1-.3 1.5-.1.5-.3.8-.6 1.1-.3.3-.6.6-1 .7a3 3 0 01-1.1.3l-1.2-.3-1-.8v.9h-1.7zm12.3 0v-.7c-.3.3-.6.5-1 .6-.3.2-.7.3-1.2.3a2.6 2.6 0 01-1.5-.6c-.3-.2-.5-.4-.6-.7l-.2-1c0-.4 0-.7.2-1 .1-.3.3-.5.6-.7.2-.1.4-.3.7-.3l.8-.2c.5 0 .9.1 1.3.3.4 0 .7.3.9.6v-1a1 1 0 00-.4-.8c-.3-.2-.7-.3-1.1-.3-.8 0-1.4.3-2 .8l-.7-1.2a4 4 0 011.4-.8 4.8 4.8 0 012.7-.1c.4 0 .7.2 1 .4l.6.8c.2.3.3.7.3 1.2V29h-1.8zm-1.4-1c.2 0 .5 0 .8-.2.2 0 .4-.2.6-.4v-.9l-.6-.4-.8-.2c-.4 0-.7.1-1 .3-.2.2-.3.4-.3.8 0 .3.1.5.3.7.3.2.6.3 1 .3zm7.4 1.2c-.6 0-1.2-.1-1.7-.3-.6-.2-1-.5-1.4-.8l.8-1.2.5.3.5.3.7.2.6.1c.4 0 .7 0 .9-.2.2-.1.3-.3.3-.5l-.1-.3-.3-.2-.5-.1a15.9 15.9 0 00-1.4-.4c-.3 0-.6-.2-.8-.3l-.7-.6c-.2-.3-.2-.6-.2-1l.1-.8.6-.7.8-.4c.4-.2.8-.2 1.2-.2.6 0 1.1 0 1.6.2l1.2.7-.8 1.2c-.2-.2-.4-.4-.8-.5-.4-.2-.7-.3-1.2-.3-.3 0-.5 0-.7.2-.2.2-.3.3-.3.5s0 .3.3.4l1 .3c.3 0 .6 0 .9.2l.9.3.6.7c.2.2.3.6.3 1 0 .3 0 .6-.2.9a2 2 0 01-.6.7l-.9.4-1.2.2zm7.4 0l-1.5-.3-1.1-.7a3.4 3.4 0 01-1-2.6c0-.5 0-1 .2-1.4a3.5 3.5 0 011.8-1.8 3.5 3.5 0 012.8 0c.5.1.8.4 1.1.7.3.3.5.7.7 1.2.2.4.2 1 .2 1.5v.4h-5c0 .4.3.8.6 1 .3.4.8.6 1.4.6a2.8 2.8 0 001.8-.7l.8 1.1c-.4.3-.8.6-1.3.7a5 5 0 01-1.5.3zm1.5-4.2v-.5l-.4-.5-.5-.4-.7-.1-.8.1-.5.4-.3.5-.1.5h3.3z"/>
  </svg>
  </a>
</template>

<div class="download">
  <div class="download__title">Get Keybase</div>
  <p class="download__description">
    Keybase is a safe, secure, and private app for everything you do online.
  </p>
</div>
<script>
let ua = window.navigator.userAgent;
let platform = 'unknown';

if (ua.indexOf('Android') !== -1) { platform = 'android'; }
else if (ua.indexOf('Linux') !== -1) { platform = 'linux'; }
else if (ua.indexOf('Windows') !== -1) { platform = 'windows'; }
else if (ua.indexOf('Win32') !== -1) { platform = 'windows'; }
else if (ua.indexOf('iPhone') !== -1) { platform = 'ios'; }
else if (ua.indexOf('iPad') !== -1) { platform = 'ios'; }
else if (ua.indexOf('Mac OS') !== -1) { platform = 'mac'; }

let temp = document.querySelector('#link-' + platform);
let clone = temp.content.cloneNode(true);

document.querySelector("div.download").appendChild(clone);
</script>
    <span class="site-footer__copyright">(C) Keybase — 2022</span>
    <span class="site-footer__disclaimer">Keybase Book is <a href="https://github.com/keybase/book-content/">open source</a>.</span>
  </div>
</footer>
  </body>
</html>